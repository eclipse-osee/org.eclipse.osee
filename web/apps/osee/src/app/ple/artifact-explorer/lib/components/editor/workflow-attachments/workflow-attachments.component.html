<!--
/*********************************************************************
 * Copyright (c) 2025 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 **********************************************************************/
-->
<!-- Header toolbar with bulk actions -->
<div class="tw-mb-3 tw-flex tw-items-center tw-justify-between">
	<h2 class="tw-text-xl tw-font-semibold">Attachments</h2>
	<div class="tw-flex tw-gap-2">
		<button
			mat-raised-button
			class="tw-bg-primary tw-text-background-background hover:tw-bg-osee-neutral-87"
			(click)="openAddDialog()"
			[disabled]="loading()">
			Add Attachments
		</button>
		<button
			mat-raised-button
			class="tw-bg-primary tw-text-background-background hover:tw-bg-osee-neutral-87 disabled:tw-bg-background-selected-disabled-button"
			(click)="deleteSelected()"
			[disabled]="loading() || selectedCount() === 0">
			Delete Selected
		</button>
	</div>
</div>

<!-- Error and loading -->
<div
	*ngIf="error()"
	class="tw-relative tw-rounded tw-border-2 tw-border-osee-red-17 tw-bg-osee-red-12 tw-p-3 tw-pr-10 tw-text-osee-red-6"
	role="alert"
	aria-live="polite">
	<div>
		{{ error() }}
	</div>

	<button
		type="button"
		mat-icon-button
		class="tw-absolute tw-right-1 tw-top-1 tw-flex tw-items-center tw-justify-center tw-text-osee-red-6 hover:tw-bg-osee-red-11"
		aria-label="Dismiss error"
		(click)="error.set(null)">
		<mat-icon>close</mat-icon>
	</button>
</div>
@if (loading()) {
	<span class="tw-text-gray-500">Loading...</span>
}
@if (isEmpty()) {
	<span class="tw-text-gray-500">No attachments yet.</span>
}

@if (!isEmpty()) {
	<table
		mat-table
		[dataSource]="attachments()"
		class="mat-elevation-z1 tw-w-full">
		<!-- Select column -->
		<ng-container matColumnDef="select">
			<th
				mat-header-cell
				*matHeaderCellDef>
				<mat-checkbox
					[checked]="allSelected()"
					[indeterminate]="isIndeterminate()"
					(change)="masterToggle($event.checked)"
					aria-label="Select all"></mat-checkbox>
			</th>
			<td
				mat-cell
				*matCellDef="let att">
				<mat-checkbox
					(change)="toggle(att.id, $event.checked)"
					[checked]="isSelected(att.id)"
					aria-label="Select row"></mat-checkbox>
			</td>
		</ng-container>

		<!-- Name -->
		<ng-container matColumnDef="name">
			<th
				mat-header-cell
				*matHeaderCellDef>
				Name
			</th>
			<td
				mat-cell
				*matCellDef="let att">
				<span
					class="tw-inline-block tw-truncate"
					[matTooltip]="att.name"
					matTooltipShowDelay="400">
					{{ att.name }}
				</span>
			</td>
		</ng-container>

		<!-- Size -->
		<ng-container matColumnDef="sizeInBytes">
			<th
				mat-header-cell
				*matHeaderCellDef>
				Size
			</th>
			<td
				mat-cell
				*matCellDef="let att">
				{{
					att.sizeInBytes === 0
						? 'Unknown'
						: (att.sizeInBytes | bytes: 0)
				}}
			</td>
		</ng-container>

		<!-- Extension -->
		<ng-container matColumnDef="extension">
			<th
				mat-header-cell
				*matHeaderCellDef>
				Ext
			</th>
			<td
				mat-cell
				*matCellDef="let att">
				.{{ att.extension }}
			</td>
		</ng-container>

		<!-- Actions -->
		<ng-container matColumnDef="actions">
			<th
				mat-header-cell
				*matHeaderCellDef
				class="tw-text-right">
				Actions
			</th>
			<td
				mat-cell
				*matCellDef="let att"
				class="tw-text-right">
				<button
					mat-button
					(click)="openAttachment(att)"
					[disabled]="loading()">
					Open
				</button>
				<button
					mat-button
					(click)="downloadAttachment(att)"
					[disabled]="loading()">
					Download
				</button>
				<button
					mat-button
					(mousedown)="$event.preventDefault()"
					(click)="openUpdateDialog(att)"
					[disabled]="loading()">
					Update
				</button>
				<button
					mat-button
					(click)="deleteSingle(att)"
					[disabled]="loading()">
					Delete
				</button>
			</td>
		</ng-container>

		<tr
			mat-header-row
			*matHeaderRowDef="displayedColumns"></tr>
		<tr
			mat-row
			*matRowDef="let row; columns: displayedColumns"></tr>
	</table>
}
