<!--
/*********************************************************************
 * Copyright (c) 2025 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 **********************************************************************/
-->
<div mat-dialog-title>
	<h3 class="tw-font-semibold">Add attachments</h3>
</div>

<div
	mat-dialog-content
	class="tw-p-4">
	<!-- Drag-and-drop area -->
	<div
		class="tw-rounded tw-border-2 tw-border-dashed tw-border-osee-neutral-25 tw-p-6 tw-text-center tw-transition-colors dark:tw-border-osee-neutral-100"
		[class.tw-border-blue-500]="dragActive()"
		[class.tw-bg-blue-50]="dragActive()"
		(dragover)="onDragOver($event)"
		(dragleave)="onDragLeave($event)"
		(drop)="onDrop($event)">
		<div class="tw-space-y-2">
			<div class="tw-font-medium tw-text-osee-neutral-60">
				Drag & drop files here
			</div>
			<div class="tw-text-sm tw-text-osee-neutral-60">or</div>

			<!-- Hidden file input -->
			<input
				#fileInput
				type="file"
				class="tw-hidden"
				[attr.accept]="data.accept || null"
				(change)="onFileInputChange($event)"
				multiple />

			<!-- Material raised button triggers hidden input -->
			<button
				mat-raised-button
				type="button"
				(click)="fileInput.click()"
				class="tw-rounded tw-bg-osee-blue-6 tw-text-osee-neutral-100 hover:tw-bg-osee-blue-7"
				aria-label="Choose file">
				Choose file
			</button>
		</div>
	</div>

	<!-- Selected files list -->
	<div class="tw-mt-4">
		@if (files().length === 0) {
			<div class="tw-text-sm tw-text-osee-neutral-60">
				No files selected.
			</div>
		} @else {
			<mat-list
				class="tw-divide-y tw-divide-osee-neutral-25 tw-rounded tw-border tw-border-osee-neutral-25 tw-py-0 dark:tw-divide-osee-neutral-100 dark:tw-border-osee-neutral-100">
				@for (f of files(); track f; let i = $index) {
					<mat-list-item class="tw-flex tw-items-center tw-gap-3">
						<!-- Left: filename (wraps, no clipping) -->
						<span
							#nameEl
							matListItemTitle
							[matTooltip]="f.name"
							matTooltipShowDelay="300"
							>{{ f.name }}</span
						>

						<!-- Right: bytes + remove button together -->
						<div
							matListItemMeta
							class="tw-flex tw-items-center tw-gap-3">
							<div
								class="tw-whitespace-nowrap tw-text-xs tw-text-osee-neutral-50">
								({{ f.size | bytes: 0 }})
							</div>
							<button
								mat-button
								class="tw-inline-flex tw-h-8 tw-min-w-max tw-shrink-0 tw-items-center tw-justify-center tw-rounded tw-bg-osee-red-24 tw-px-3 tw-text-osee-neutral-100 hover:tw-bg-osee-red-21"
								type="button"
								(click)="removeFile(i)">
								Remove
							</button>
						</div>
					</mat-list-item>
				}
			</mat-list>

			<div class="tw-mt-2 tw-flex tw-justify-end">
				<button
					mat-button
					class="tw-rounded tw-bg-osee-amber-16 tw-px-2 tw-py-1 tw-text-osee-neutral-6 hover:tw-bg-osee-amber-23"
					type="button"
					(click)="clear()">
					Clear all
				</button>
			</div>
		}
	</div>
</div>

<div
	mat-dialog-actions
	class="tw-flex tw-justify-end tw-gap-2 tw-px-4 tw-pb-4">
	<button
		mat-button
		class="tw-rounded tw-bg-osee-neutral-35 tw-px-3 tw-py-2 tw-text-osee-neutral-100 hover:tw-bg-osee-neutral-50"
		type="button"
		(click)="cancel()">
		Cancel
	</button>
	<button
		mat-button
		class="tw-rounded tw-bg-primary tw-px-3 tw-py-2 tw-text-background-background hover:tw-bg-osee-neutral-87 disabled:tw-opacity-50"
		color="primary"
		type="button"
		[disabled]="files().length === 0"
		(click)="submit()">
		Add
	</button>
</div>
