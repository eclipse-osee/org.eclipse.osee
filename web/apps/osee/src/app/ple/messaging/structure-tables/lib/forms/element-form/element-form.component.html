<!--
* Copyright (c) 2023 Boeing
*
* This program and the accompanying materials are made
* available under the terms of the Eclipse Public License 2.0
* which is available at https://www.eclipse.org/legal/epl-2.0/
*
* SPDX-License-Identifier: EPL-2.0
*
* Contributors:
*     Boeing - initial API and implementation
-->
<div
	ngModelGroup="elementForm"
	elementForm="ngModelGroup">
	<mat-form-field class="tw-w-full">
		<mat-label>Name</mat-label>
		<input
			matInput
			[(ngModel)]="name"
			required
			name="name"
			data-testid="element-form-name" />
		<mat-hint>Name of the element being created</mat-hint>
	</mat-form-field>
	<br />
	<mat-form-field class="tw-w-full">
		<mat-label>Description</mat-label>
		<textarea
			cdkTextareaAutosize
			matInput
			[(ngModel)]="description"
			name="description"
			data-cy="field-description"></textarea>
		<mat-hint>Description of the element being created</mat-hint>
	</mat-form-field>
	<br />
	<mat-form-field class="tw-w-full">
		<mat-label>Notes</mat-label>
		<textarea
			cdkTextareaAutosize
			matInput
			[(ngModel)]="notes"
			name="notes"
			data-cy="field-notes"></textarea>
		<mat-hint>Notes associated with the element being created</mat-hint>
	</mat-form-field>
	<br />
	<mat-form-field class="tw-w-full">
		<mat-label>Enum Literals</mat-label>
		<textarea
			cdkTextareaAutosize
			matInput
			[(ngModel)]="enumLiteral"
			name="enum_literal"
			data-cy="field-enum-literal"></textarea>
		<mat-hint>Enum Literals</mat-hint>
	</mat-form-field>
	<br />
	<mat-slide-toggle
		[(ngModel)]="interfaceElementAlterable"
		labelPosition="before"
		name="alterable"
		data-cy="field-alterable"
		class="tw-py-2">
		Alterable
	</mat-slide-toggle>
	<br />
	<mat-slide-toggle
		[(ngModel)]="interfaceElementBlockData"
		labelPosition="before"
		name="blockdata"
		data-cy="field-block-data"
		class="tw-py-2">
		Block Data Element
	</mat-slide-toggle>
	<br />
	<osee-applicability-dropdown
		[(applicability)]="applicability"
		[required]="true"></osee-applicability-dropdown>
	<br />
	<div class="tw-flex tw-justify-evenly tw-gap-4 tw-pt-4">
		<mat-form-field
			class="tw-w-full"
			subscriptSizing="dynamic">
			<mat-label>Start Index</mat-label>
			<input
				type="number"
				matInput
				[(ngModel)]="interfaceElementIndexStart"
				required
				name="index_start"
				data-cy="field-index-start" />
			<mat-hint
				>Starting index of the element array being created(if inserting
				an array of elements)</mat-hint
			>
		</mat-form-field>
		<mat-form-field
			class="tw-w-full"
			subscriptSizing="dynamic">
			<mat-label>End Index</mat-label>
			<input
				type="number"
				matInput
				[(ngModel)]="interfaceElementIndexEnd"
				required
				name="index_end"
				data-cy="field-index-end" />
			<mat-hint
				>Ending index of the element array being created(if inserting an
				array of elements)</mat-hint
			>
		</mat-form-field>
	</div>
	@if (data().allowArray) {
		@if (data().mode === 'add') {
			<mat-slide-toggle
				labelPosition="before"
				name="arrayHeaderToggle"
				[(ngModel)]="interfaceElementArrayHeader"
				(ngModelChange)="toggleArrayHeader($event)"
				data-cy="field-array-header-toggle"
				class="tw-py-2">
				Array Header
			</mat-slide-toggle>
		}
	}

	@if (data().arrayChild || interfaceElementArrayHeader()) {
		<br />
		<mat-slide-toggle
			labelPosition="before"
			name="arrayWriteHeaderNameToggle"
			[(ngModel)]="interfaceElementWriteArrayHeaderName"
			data-cy="field-array-write-header-name-toggle"
			class="tw-py-2">
			Use Array Header Name in Reports
		</mat-slide-toggle>
	}

	@if (data().allowArray) {
		@if (interfaceElementArrayHeader()) {
			@if (interfaceElementArrayHeader()) {
				<br />
				<ng-template *ngTemplateOutlet="arrayFields"></ng-template>
			}
			<mat-label class="tw-m-0 tw-block tw-py-2 tw-text-foreground-base"
				>Array Elements</mat-label
			>
			@for (e of arrayElements(); track e) {
				@if (!e.autogenerated) {
					<div class="tw-grid tw-grid-cols-[1fr_auto_auto] tw-pl-2">
						<div>
							{{ e.name.value }}
						</div>
						@if (e.id === '-1') {
							<button
								mat-icon-button
								type="button"
								(click)="editArrayElement(e)"
								matTooltip="Edit {{ e.name.value }}">
								<mat-icon
									class="tw-text-osee-yellow-10 dark:tw-text-osee-amber-9"
									>edit</mat-icon
								>
							</button>
						}
						<button
							mat-icon-button
							type="button"
							(click)="removeFromArray(e)"
							matTooltip="Remove {{ e.name.value }} from array">
							<mat-icon class="tw-text-osee-red-9"
								>remove_circle_outline</mat-icon
							>
						</button>
					</div>
				}
			}
			<button
				mat-icon-button
				type="button"
				(click)="addArrayElement()">
				<mat-icon class="tw-text-osee-green-9">add</mat-icon>
			</button>
		}
	} @else if (interfaceElementArrayHeader()) {
		<br />
		<ng-template *ngTemplateOutlet="arrayFields"></ng-template>
	}

	@if (!interfaceElementArrayHeader()) {
		<br />
		@if (typeState() === 'SELECT') {
			<osee-platform-type-dropdown
				[(platformType)]="platformType"
				[required]="true"
				[extraPlatformTypes]="createdPlatformTypes()"
				class="tw-w-full">
				<button
					preLocation
					mat-icon-button
					class="tertiary-icon-button"
					(click)="openPlatformTypeDialog($event)"
					data-testid="create-platform-type-button"
					matTooltip="Create New Platform Type">
					<mat-icon class="tertiary-icon-button">add</mat-icon>
				</button>
			</osee-platform-type-dropdown>
		}
		@if (typeState() === 'CREATE') {
			<button
				mat-icon-button
				(click)="closeAddMenu()"
				matTooltip="Cancel Platform Type Creation">
				<mat-icon class="tw-text-osee-red-9"> close </mat-icon>
			</button>
			<mat-divider></mat-divider>
			<osee-new-type-form
				(result)="receivePlatformTypeData($event)"
				[(platformType)]="platformType"></osee-new-type-form>
			<br />
		}
		<!-- TODO: create query page to allow users to query based on different platform type parameters and add as a routerLink to above^^: -->
	}
</div>
<ng-template #arrayFields>
	@if (!interfaceElementWriteArrayHeaderName()) {
		<br />
		<div class="tw-flex tw-w-full tw-gap-12">
			<div class="tw-flex tw-w-80 tw-flex-col tw-gap-2">
				<mat-form-field subscriptSizing="dynamic">
					<mat-label>Array Index Order</mat-label>
					<mat-select
						[(ngModel)]="interfaceElementArrayIndexOrder"
						name="arrayIndexFormat"
						[compareWith]="compareArrayIndexOrders"
						data-cy="field-array-index-format">
						@for (
							option of arrayIndexOrders | async;
							track option
						) {
							<mat-option
								[value]="option.name"
								[attr.data-cy]="'option-' + option.name">
								{{ option.formattedName }}
							</mat-option>
						}
					</mat-select>
				</mat-form-field>
				<mat-form-field subscriptSizing="dynamic">
					<mat-label>Array Index Delimiter 1</mat-label>
					<textarea
						cdkTextareaAutosize
						matInput
						[(ngModel)]="interfaceElementArrayIndexDelimiterOne"
						name="arrayIndexDelimiterOne"
						data-cy="field-delimiter-one"></textarea>
				</mat-form-field>
				<mat-form-field subscriptSizing="dynamic">
					<mat-label>Array Index Delimiter 2</mat-label>
					<textarea
						cdkTextareaAutosize
						matInput
						[(ngModel)]="interfaceElementArrayIndexDelimiterTwo"
						name="arrayIndexDelimiterTwo"
						data-cy="field-delimiter-two"></textarea>
				</mat-form-field>
			</div>
			<div class="tw-whitespace-pre">
				<mat-label>Array Example:</mat-label>
				<ul>
					@for (example of arrayExample(); track $index) {
						<li>{{ example }}</li>
					}
				</ul>
			</div>
			<div class="tw-whitespace-pre">
				<mat-label>Element Example:</mat-label>
				<ul>
					@for (example of elementExample(); track $index) {
						<li>{{ example }}</li>
					}
				</ul>
			</div>
		</div>
	}
</ng-template>
