# 1. Objective

This document defines the requirements for the Surgical Assistant Workstation for Teleoperated Surgical Robots (SAWTSR) being developed by Johns Hopkins University and Intuitive Surgical. This document provides requirements for the workstation system and does not include application requirements. It is expected that applications developed on this workstation would define their own requirements (i.e., in a separate document).

# 2. References

## 2.1 Project-Specific

- “Development of a Surgical Assistant Workstation for Teleoperated Surgical Robots,” proposal for NSF ERC Supplement, July 2006.
- “Intuitive Surgical daVinci API v5.0 Reference Manual”, generated July 14, 2006.
- J. Leven, D. Burschka, R. Kumar, G. Zhang, S. J. Blumenkranz, X. Dai, M. Awad, G. Hager, M. Marohn, M. Choti, C. Hasser and R. H. Taylor “DaVinci Canvas: A Telerobotic Surgical System with Integrated, Robot-Assisted, Laparoscopic Ultrasound Capability,” in MICCAI, vol. LNCS 3749, J. Duncan and G. Gerig, Eds. Palm Springs, CA: Springer-Verlag, 2005, pp. 811-818.
- J. Leven, “A Telerobotic Surgical Systems with Integrated Robot-Assisted Laparoscopic Ultrasound Capability”, MS Thesis, Computer Science, Johns Hopkins University, Baltimore, 2005.

## 2.2 Calibration and Registration Techniques

- B.K.P. Horn, “Closed-form solution of absolute orientation using unit quaternions,” J. Opt. Soc. Amer. A, Vol. 4, No. 4, pp. 629–642, Apr. 1987.
- K.S. Arun, T.S. Huang, S.D. Blostein, “Least-Squares Fitting of Two 3D Point Sets”, IEEE PAMI, Vol. 9, No. 4, pp. 698-700, Sept. 1987.
- S. Umeyama, “Least-Squares Estimation of Transformation Parameters Between Two Point Patterns”, IEEE PAMI, Vol. 13, No. 4, pp. 376-380, Apr. 1991.
- Boctor, A. Viswanathan, M. Choti, R. Taylor, G. Fichtinger, G. Hager, “A Novel Closed Form Solution for Ultrasound Calibration,” IEEE Intl. Symp. Bio. Imag. (ISBI), Arlington, VA, pp 527-530, Apr. 2004.
- P. J. Besl and N. D. McKay, "A Method for Registration of 3-D Shapes," IEEE Transactions on Pattern Analysis and Machine Intelligence, vol. 14, pp. 239256, Feb. 1992.

## 2.3 Virtual Fixtures and Constrained Optimization

- Kapoor, M. Li, R.H. Taylor, “Constrained Control for Surgical Assistant Robots”, Proc. IEEE Intl. Conf. on Robotics and Automation, Orlando, FL, May 2006, pp 231-236.
- M. Li, A. Kapoor and R. H. Taylor “A Constrained Optimization Approach to Virtual Fixtures,” in IROS. Edmonton, Alberta, Canada, 2005.
- M. Li and R. H. Taylor, “Performance of Teleoperated and cooperatively controlled surgical robots with automatically generated spatial virtual fixtures.,” in IEEE International Conference on Robotics and Automation. Barcelona, Spain, 2005.
- M. Li, “Intelligent Robotic Surgical Assistance for Sinus Surgery”, Ph.D. Thesis, Computer Science, The Johns Hopkins University, Baltimore, Maryland, 2005.
- M. Li and R. H. Taylor, “Spatial Motion Constraints in Medical Robots Using Virtual Fixtures Generated by Anatomy,” in IEEE Conf. on Robotics and Automation. New Orleans, 2004, pp. 1270-1275.

# 3. Robot System Overview

The goal is to create a unified assistive environment for surgery that integrates robotic devices; fused information environments combining preoperative images & models, intraoperative images & other sensors; surgical task modeling; and human-machine cooperative manipulation, as shown in Figure 1 (from Reference 2.1.1).

<oseeimagelink>[6829343659904028894]-[SAWTSR]</oseeimagelink>

Figure 1: Overview of SAWTSR Architecture
In this document, the system requirements are categorized by the major subsystem:

## 3.1 Robot API Subsystem

This subsystem corresponds to the interface to the robot or robots; although the design shall be influenced by the existing daVinci research API, it shall be usable for other robot systems.

## 3.2 Video processing Subsystem

This subsystem provides the processing of 2D (e.g., ultrasound) and 3D (e.g., stereo video) images, using image pipelines.

## 3.3 Other device interfaces Subsystem

This subsystem provides interfaces to devices other than robots and video systems, including force sensors, foot pedals, tissue oxygenation sensors, etc.

## 3.4 Calibration and registration Subsystem

This subsystem provides tools for calibrating devices or (at a minimum) for reading the calibration results produced by an external system (e.g., Matlab programs). It also provides methods for computing coordinate transformations (e.g., registration).

## 3.5 Tool tracking Subsystem

This subsystem provides the capability for tracking the positions of tools using some combination of sensor feedback (e.g., joint encoder positions and stereo video images).

## 3.6 User Interface (Visualization) Subsystem

This subsystem provides the 2D and 3D graphical displays and accepts control information from input devices (including the master manipulators in a telesurgical system).

## 3.7 Telesurgery application framework

This corresponds to a working “skeleton” application, which the researcher can customize. System-level requirements are listed in this category.

<oseeimagelink>[8446203177483923452]-[Robot Data Flow]</oseeimagelink>

Figure 2: Illustrative data flow

## 3.8 Volume Viewer

This is an application-level “widget” that allows the user to view and manipulate medical images, using the daVinci master manipulators as input devices.
Figure 2 shows an illustrative data flow diagram, focusing on the robot API and the pipeline for the video processing and visualization. This figure also shows the tool tracking and volume viewer subsystems. Although not specifically shown, calibration and registration functions are required. Note that other data flow configurations are possible, depending on the application requirements.

# 4. Performance Requirements

The system shall have at least one periodic loop (“heartbeat”) that interacts with the hardware devices and/or proprietary device interface software. Many of the following performance requirements depend on the frequency of this periodic loop.

## 4.1 Robot API

Note: The following performance parameters are highly dependent on the particular robot that is used. The numbers cited below apply to the daVinci robot systems, but it is expected that other robot systems will meet or exceed these minimum requirements.

### 4.1.1 Read-only Minimum Rate

The minimum update rate for receiving state information (e.g., robot positions) from a read-only robot shall be 50 Hz (20 msec)

### 4.1.2 Read-Write Minimum Rate

The minimum update rate for receiving state information (e.g., robot positions) from a read-write robot shall be 30 Hz.

### 4.1.3 Commanding Minimum Rate

The minimum update rate for commanding state changes (e.g., providing position goals) shall be 30 Hz, subject to physical constraints (e.g., robot must be able to reach target positions within update cycle).

### 4.1.4 Detection Latency

The maximum latency between detection of a physical state change and availability of this information from the robot API shall be 100 msec.

### 4.1.5 Commanded State Latency

The maximum latency between a commanded state change and the corresponding hardware output shall be 100 msec.

## 4.2 Video processing

### 4.2.1 Video Capture Frame Rate

The video capture frame rate shall be 30 frames per second.

### 4.2.2 Video Capture Latency

The latency due to video capture shall not exceed 2 time frames (depends on video capture hardware).

### 4.2.3 Overlayed Video Frame Rate

The processed and overlayed video frame rate shall be at least 10 frames per second.

### 4.2.4 Video Processing Latency

The latency due to video processing shall not exceed 1 time frame (e.g., 100 msec at 10 frames per second).

### 4.2.5 Stereo Reconstruction Resolution

The stereo reconstruction resolution is a function of the baseline width (distance between cameras), depth (distance from the cameras), camera resolution, and focal length. For a baseline of 5 mm (worst case for daVinci endoscope) and camera resolution of 640 x 480, the following resolutions are obtained (results in mm):

|               |         | **Focal length, pixels** |         |          |
| :------------ | :-----: | :----------------------: | :-----: | :------: |
| **Depth, mm** | **700** |         **800**          | **900** | **1000** |
| **50**        |  0.70   |           0.62           |  0.55   |   0.50   |
| **100**       |  2.78   |           2.44           |  2.17   |   1.96   |
| **150**       |  6.16   |           5.42           |  4.84   |   4.37   |
| **200**       |  10.81  |           9.52           |  8.51   |   7.69   |
| **250**       |  16.67  |          14.71           |  13.16  |  11.90   |

### 4.2.6 Registration Error Limit

The registration error between 3D anatomic models and the live (video) image shall not exceed 1.5 times (150% of) the stereo reconstruction resolution, at a specified depth and focal length (see 5.2.5), not including errors due to organ deformation.

### 4.2.7 Initial Registration Limit

The initial registration shall require no more than 1 second of computation time.

### 4.2.8 Visualization Latency

The latency due to the visualization shall not exceed 10 msec (depends on video output hardware).

## 4.3 Other device interfaces

### 4.3.1 Minimum Update Rate

The minimum update rate for receiving information from other devices (e.g., force sensor, tracker, etc.) shall be 50 Hz (20 msec).

### 4.3.2 Force Data Latency

The latency of the force data (e.g., time between physical application of force and software reception of force measurement) shall be no more than 40 msec.

### 4.3.3 Tracker Data Latency

The latency of the tracker data (e.g., time between physical motion and software reception of new position) shall be no more than 100 msec.

## 4.4 Calibration and registration

Note: Calibration and registration performance requirements shall be specified in the application requirements document, rather than in this system (workstation) requirements document.

## 4.5 Tool Tracking

Note: The following specifications are for the daVinci stereoscopic endoscopes and the Intuitive tool tracking software implementation.

### 4.5.1 Tool Tracking Update Rate

The update rate of Tool Tracking shall be no more than 200 ms.

### 4.5.2 Tool Tracking Latency

The latency of Tool Tracking shall be no more than the update rate (the time to process 1 frame).

### 4.5.3 Position Accuracy

The position of an instrument shall be determined with an average accuracy of at least 4 mm, at a distance of 75-80 mm.

## 4.6 User Interface (Visualization)

## 4.7 Telesurgery application framework

### 4.7.1 Time Synchronization

The time synchronization between different components shall be defined by the minimum (slowest) update rate of the components (e.g., if the slowest component updates every 100 msec, the time synchronization shall be within 100 msec).

### 4.7.2 System Heartbeat

The system heartbeat shall be 20 msec or less.

## 4.8 Volume viewer

# 5. Safety Requirements

## 5.1 Robot API

### 5.1.1 Power Disable

The read-write Robot API shall include a software command to allow application programs to disable power to the robot motors.

### 5.1.2 Emergency Disengagement

The system shall provide a method for disengaging the research interface from any clinical robot capable of operating in a stand-alone manner (e.g., the daVinci) for emergency responses.

## 5.2 Video processing

## 5.3 Other device interfaces

### 5.3.1 Emergency Stop Switch

The system shall include an “emergency stop” switch that disables power to the robot motors and any other potentially hazardous device.

## 5.4 Calibration and registration

### 5.4.1 Computation Methods

The computation methods shall indicate the residual error, so that users can determine how much confidence to place in the result.

## 5.5 Tool tracking

## 5.6 User Interface (Visualization)

### 5.6.1 Unmodified Visualization

The system shall provide a method for disengaging the research visualization output, so that a clinician can revert to the visualization provided by an unmodified clinical robot (e.g., a clinical daVinci).

## 5.7 Telesurgery application framework

### 5.7.1 Periodic Safety Check

The application framework shall periodically check all safety-critical subsystems (e.g., by verifying communication integrity) and initiate a safety response (e.g., using function 6.1.1) if a failure is detected.

## 5.8 Volume viewer

# 6. Design Constraints

## 6.1 Operating System

The system shall be designed to operate on Red Hat Enterprise Linux WS 4. It is desirable for it to work with any type of Linux, with future extension to a real-time Linux such as RTAI.

## 6.2 Programming Language

The software shall be written in C/C++.

## 6.3 Software Libraries

### 6.3.1 CISST Libraries

The software shall use the CISST libraries.

### 6.3.2 VTK

The software shall use the Visualization Toolkit (VTK) for visualization of images. The software may optionally use other toolkits that build on, or extend, VTK.

### 6.3.3 Intuitive Surgical

The tool tracking module shall be based on existing code from Intuitive Surgical.

### 6.3.4 daVinci research API

The daVinci research API shall be jointly evaluated by ISI and JHU to determine whether to add a requirement to port it to use the CISST operating system abstraction and real-time support libraries (for the thread that manages the data stream).
