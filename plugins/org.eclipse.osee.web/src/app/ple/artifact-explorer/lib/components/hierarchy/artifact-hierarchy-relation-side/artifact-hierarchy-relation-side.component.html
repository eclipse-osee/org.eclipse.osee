<!--
 * Copyright (c) 2023 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<div
	class="tw-flex tw-py-1 tw-pl-4"
	[ngClass]="isOpen() ? 'tw-bg-background-hover' : ''">
	<!-- expand icon button -->
	<button
		(click)="isOpen() ? close() : open()"
		class="tw-flex tw-items-center hover:tw-text-primary">
		<!-- animated icon -->
		<mat-icon
			matListItemIcon
			[ngClass]="
				isOpen()
					? 'tw-rotate-90 tw-transform tw-transition-transform tw-duration-200 tw-ease-in'
					: 'tw-rotate-0 tw-transform tw-transition-transform tw-duration-200 tw-ease-in'
			">
			chevron_right
		</mat-icon>
	</button>
	<div class="tw-flex tw-items-center">
		<div class="tw-pl-2 tw-text-accent-700">
			<mat-icon> swap_horiz </mat-icon>
		</div>
		<div class="tw-pl-2">{{ typeName() }} - [{{ relationSideName() }}]</div>
	</div>
</div>
<ng-container *ngIf="isOpen()">
	<ng-container *ngFor="let art of artifacts(); trackBy: trackArtifacts">
		<!-- Artifact dropdown button -->
		<div class="tw-pl-8">
			<div
				class="tw-flex tw-py-1"
				[ngClass]="
					artifactsOpen().includes(art.id)
						? 'tw-bg-background-hover'
						: ''
				">
				<button
					(click)="
						artifactsOpen().includes(art.id)
							? removeArtifactsOpen(art.id)
							: addArtifactsOpen(art.id)
					"
					class="tw-flex tw-items-center tw-pl-4 hover:tw-text-primary">
					<!-- Animated icon -->
					<div
						[ngClass]="
							artifactsOpen().includes(art.id)
								? 'tw-rotate-90 tw-transform tw-transition-transform tw-duration-200 tw-ease-in'
								: 'tw-rotate-0 tw-transform tw-transition-transform tw-duration-200 tw-ease-in'
						">
						<mat-icon matListItemIcon> chevron_right </mat-icon>
					</div>
				</button>
				<button
					cdkDrag
					[cdkDragData]="art"
					class="tw-flex tw-flex-grow tw-items-center hover:tw-text-primary"
					(click)="addTab(art)">
					<div class="tw-pl-4">
						<mat-icon>
							{{ fetchIcon(art.typeName) }}
						</mat-icon>
					</div>
					<div class="tw-pl-2">
						{{ art.name }}
					</div>
				</button>
			</div>
		</div>

		<!-- Child artifacts within artifact dropdown -->
		<div
			*ngIf="artifactsOpen().includes(art.id)"
			class="tw-pl-16">
			<div *ngIf="_paths | async as paths; else noPaths">
				<osee-artifact-hierarchy
					[artifactId]="art.id"
					[paths]="paths"></osee-artifact-hierarchy>
			</div>
			<ng-template #noPaths>
				<osee-artifact-hierarchy
					[artifactId]="art.id"></osee-artifact-hierarchy>
			</ng-template>
		</div>
	</ng-container>
</ng-container>
