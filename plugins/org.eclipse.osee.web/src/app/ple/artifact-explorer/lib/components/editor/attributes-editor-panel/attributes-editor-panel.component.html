<!--
 * Copyright (c) 2023 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<mat-expansion-panel
	[expanded]="panelOpen.value"
	class="[&>div>div]:tw-px-0"
	hideToggle>
	<mat-expansion-panel-header
		(click)="togglePanel()"
		[ngClass]="panelOpen.value ? 'tw-shadow-md' : ''"
		class="tw-px-0 hover:tw-bg-background-hover">
		<mat-panel-title class="tw-flex">
			<div class="tw-px-4">
				<mat-icon>
					{{ panelOpen.value ? 'expand_more' : 'chevron_right' }}
				</mat-icon>
			</div>
			<div class="tw-font-bold">Attributes Editor</div>
		</mat-panel-title>
	</mat-expansion-panel-header>

	<div class="tw-pt-4">
		<div>
			<div class="tw-flex tw-pb-4 tw-pl-4">
				<button
					class="tw-mr-auto"
					(click)="saveChanges()">
					<mat-icon
						[ngClass]="
							isDirty ? 'tw-text-warning' : 'tw-text-primary'
						"
						>save</mat-icon
					>
				</button>
			</div>

			<ng-container *ngFor="let attribute of tab.artifact.attributes">
				<div class="tw-flex tw-justify-between">
					<div
						class="tw-flex tw-w-1/6 tw-items-center tw-pl-4 tw-font-bold">
						{{ attribute.name }}:
					</div>
					<div class="tw-w-5/6 tw-pl-4">
						<ng-container [ngSwitch]="attribute.baseType">
							<ng-container *ngSwitchCase="'ENUM'">
								<osee-attribute-enums-dropdown
									[disabled]="!tab.artifact.editable"
									[branchId]="tab.branchId"
									[artifactId]="tab.artifact.id"
									[attributeId]="attribute.typeId"
									[(attributeValue)]="attribute.value"
									(attributeValueChange)="makeDirty()" />
							</ng-container>
							<ng-container *ngSwitchCase="'STRING'">
								<mat-form-field class="tw-w-full">
									<textarea
										[disabled]="!tab.artifact.editable"
										matInput
										matInputAutosize
										placeholder="value"
										[(ngModel)]="attribute.value"
										(change)="makeDirty()"></textarea>
								</mat-form-field>
							</ng-container>
							<ng-container *ngSwitchCase="'BOOLEAN'">
								<mat-form-field class="tw-w-full">
									<mat-select
										[disabled]="!tab.artifact.editable"
										[(ngModel)]="attribute.value"
										(selectionChange)="makeDirty()">
										<mat-option> true </mat-option>
										<mat-option> false </mat-option>
									</mat-select>
								</mat-form-field>
							</ng-container>
							<ng-container *ngSwitchCase="'DATE'">
								<mat-form-field class="tw-w-full">
									<textarea
										[disabled]="!tab.artifact.editable"
										matInput
										matInputAutosize
										placeholder="value"
										[(ngModel)]="attribute.value"
										(change)="makeDirty()"></textarea>
								</mat-form-field>
							</ng-container>
							<ng-container *ngSwitchCase="'INTEGER'">
								<mat-form-field class="tw-w-full">
									<textarea
										[disabled]="!tab.artifact.editable"
										matInput
										matInputAutosize
										placeholder="value"
										[(ngModel)]="attribute.value"
										(change)="makeDirty()"></textarea>
								</mat-form-field>
							</ng-container>
							<ng-container *ngSwitchCase="'LONG'">
								<mat-form-field class="tw-w-full">
									<textarea
										[disabled]="!tab.artifact.editable"
										matInput
										matInputAutosize
										placeholder="value"
										[(ngModel)]="attribute.value"
										(change)="makeDirty()"></textarea>
								</mat-form-field>
							</ng-container>
						</ng-container>
					</div>
				</div>
				<br />
			</ng-container>
		</div>
	</div>
</mat-expansion-panel>
