<!--
 * Copyright (c) 2023 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<ng-container *ngIf="branchId$ | async as branchId">
	<ng-container *ngIf="branchType$ | async as branchType">
		<ng-container *ngIf="artifact$ | async as arts">
			<!-- artifacts -->
			<ng-container *ngFor="let artifact of arts; trackBy: trackById">
				<div
					class="tw-flex tw-py-1 tw-pl-4"
					[ngClass]="
						artifactsOpen().includes(artifact.id)
							? 'tw-bg-background-hover'
							: ''
					">
					<osee-animated-expand-button
						[open]="artifactsOpen().includes(artifact.id)"
						(openChange)="
							artifactsOpen().includes(artifact.id)
								? removeArtifactsOpen(artifact.id)
								: addArtifactsOpen(artifact.id)
						" />
					<!-- artifact icon and name button -->
					<button
						cdkDrag
						[cdkDragData]="artifact"
						class="tw-flex tw-flex-grow tw-items-center hover:tw-text-primary"
						(click)="addTab(artifact)">
						<div class="tw-pl-4">
							<mat-icon>
								{{ fetchIcon(artifact.typeName) }}
							</mat-icon>
						</div>
						<div class="tw-pl-2">
							{{ artifact.name }}
						</div>
					</button>
				</div>
				<!-- child artifacts -->
				<div
					class="tw-pl-8"
					*ngIf="artifactsOpen().includes(artifact.id)">
					<div *ngIf="latestPaths | async as paths; else noPaths">
						<osee-artifact-hierarchy
							[artifactId]="artifact.id"
							[paths]="paths" />
					</div>
					<ng-template #noPaths>
						<osee-artifact-hierarchy [artifactId]="artifact.id" />
					</ng-template>
				</div>
			</ng-container>
			<!-- relations (toggled via option) -->
			<div *ngIf="latestPaths | async as paths; else noPaths">
				<osee-artifact-hierarchy-relations
					[relation$]="relation$"
					[paths]="paths" />
			</div>
			<ng-template #noPaths>
				<osee-artifact-hierarchy-relations [relation$]="relation$" />
			</ng-template>
		</ng-container>
	</ng-container>
</ng-container>
