<!--
 * Copyright (c) 2022 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<osee-messaging-controls></osee-messaging-controls>
<ng-container *ngIf="branchId | async as _branch">
	<ng-container *ngIf="_branch !== '0' && _branch !== ' '">
		<ng-container *ngIf="branchType | async as _branchType">
			<div class="tw-pl-8">
				<ng-container *ngIf="webReportRoutes | async as routes">
					<h2 class="mat-headline-6">Web-Based Reports</h2>
					<div
						class="tw-flex tw-w-64 tw-flex-col tw-gap-4 tw-pb-4 tw-pl-4">
						<a
							*ngIf="_branchType === 'working'"
							mat-raised-button
							color="primary"
							[routerLink]="routes.diffRoute">
							Difference Report
						</a>
						<a
							mat-raised-button
							color="primary"
							[routerLink]="routes.nodeTraceRoute">
							Traceability Report
						</a>
					</div>
				</ng-container>
				<ng-container *ngIf="reports | async as _reports">
					<h2 class="mat-headline-6">Downloadable Reports</h2>
					<div class="tw-pl-4">
						<mat-form-field
							class="tw-block tw-w-64"
							appearance="fill">
							<mat-label>{{
								reportSelectionText | async
							}}</mat-label>
							<mat-select
								(selectionChange)="selectReport($event)"
								[disabled]="_reports.length === 0"
								[(value)]="selectedReport">
								<mat-option
									*ngFor="let option of _reports"
									[value]="option"
									[id]="option.id">
									{{ option.name }}
								</mat-option>
							</mat-select>
						</mat-form-field>
						<ng-container
							*ngIf="connections | async as _connections">
							<mat-form-field
								class="tw-block tw-w-64"
								appearance="fill">
								<mat-label>{{
									connectionSelectionText | async
								}}</mat-label>
								<mat-select
									(selectionChange)="selectConnection($event)"
									[disabled]="_connections.length === 0"
									[(value)]="selectedConnection">
									<mat-option
										*ngFor="let option of _connections"
										[value]="option"
										[id]="option.id!">
										{{ option.name }}
									</mat-option>
								</mat-select>
							</mat-form-field>
						</ng-container>
						<ng-container *ngIf="applicViews | async as _views">
							<mat-form-field
								class="tw-block tw-w-64"
								appearance="fill">
								<mat-label>Select a view</mat-label>
								<mat-select
									[disabled]="_views.length === 0"
									[(value)]="selectedApplic">
									<mat-option
										*ngFor="let option of _views"
										[value]="option"
										[id]="option.id!">
										{{ option.name }}
									</mat-option>
								</mat-select>
							</mat-form-field>
						</ng-container>
						<ng-container
							*ngIf="selectedReport?.httpMethod === 'POST'">
							<p>Select a file or enter JSON</p>
							<input
								type="file"
								(change)="selectFile($event)"
								accept=".json,.csv,.txt"
								class="tw-mb-2" />
							<mat-form-field
								appearance="fill"
								class="tw-block tw-w-[500px]">
								<mat-label>Enter JSON</mat-label>
								<textarea
									matInput
									[(ngModel)]="requestBody"
									placeholder="{...}"></textarea>
							</mat-form-field>
						</ng-container>
						<ng-container *ngIf="selectedReport?.diffAvailable">
							<mat-checkbox
								class="tw-block"
								[(ngModel)]="includeDiff"
								color="primary"
								cdkFocusInitial>
								<mat-label
									>Show differences in report</mat-label
								>
							</mat-checkbox>
						</ng-container>
						<button
							mat-raised-button
							color="primary"
							(click)="getSelectedReport()"
							[disabled]="
								!selectedReport ||
								!selectedConnection ||
								selectedConnection.id === '-1'
							"
							class="tw-mt-4">
							Get Report
						</button>
					</div>
				</ng-container>
			</div>
		</ng-container>
	</ng-container>
</ng-container>
