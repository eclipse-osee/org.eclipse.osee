<!--
 * Copyright (c) 2021 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<mat-form-field
	cdkMonitorSubtreeFocus
	(cdkFocusChange)="focusChanged($event)"
	subscriptSizing="dynamic"
	class="wide-form">
	<input
		matInput
		[(ngModel)]="value"
		(ngModelChange)="updateElement(header, value)"
		*ngIf="
			header !== 'platformTypeName2' &&
			header !== 'applicability' &&
			header !== 'units'
		"
		[disabled]="
			editingDisabled ||
			((header === 'interfaceElementIndexStart' ||
				header === 'interfaceElementIndexEnd') &&
				elementEnd === 0 &&
				elementStart === 0)
		" />
	<ng-container *ngIf="header === 'name'">
		<ng-container *ngIf="elementEnd - elementStart > 0">
			<p matSuffix>
				{{ '[' + elementStart + '...' + elementEnd + ']' }}
			</p>
		</ng-container>
	</ng-container>
	<ng-container
		*ngIf="
			header === 'platformTypeName2' ||
			header === 'applicability' ||
			header === 'units'
		">
		<ng-container *ngIf="header === 'applicability'">
			<mat-select
				[(ngModel)]="value"
				(ngModelChange)="updateImmediately(header, value)"
				[compareWith]="compareApplics"
				[disabled]="editingDisabled">
				<mat-option
					*ngFor="let option of applics | async"
					[value]="option"
					[id]="option.id">
					{{ option.name }}
				</mat-option>
			</mat-select>
		</ng-container>
		<ng-container *ngIf="header === 'platformTypeName2'">
			<div style="display: flex; flex-direction: row">
				<input
					matInput
					type="search"
					[(ngModel)]="value"
					[matAutocomplete]="auto"
					(ngModelChange)="updateTypeAhead(value)"
					[disabled]="editingDisabled" />
				<ng-container *ngIf="_location | async as location">
					<a
						mat-icon-button
						matSuffix
						[routerLink]="
							'/ple/messaging/' +
							location.type +
							'/' +
							location.id +
							'/type/' +
							platformTypeId
						"
						(contextmenu)="openMenu($event, value)"
						><mat-icon>arrow_forward</mat-icon></a
					>
				</ng-container>
			</div>
			<mat-autocomplete
				autoActiveFirstOption
				#auto="matAutocomplete"
				(optionSelected)="updateType($event.option.value)">
				<mat-option
					*ngFor="let option of filteredTypes | async"
					[value]="option"
					[id]="
						option !== undefined && option.id !== undefined
							? option.id
							: ''
					">
					{{ option.name }}
				</mat-option>
			</mat-autocomplete>
		</ng-container>
		<ng-container *ngIf="header === 'units'">
			<mat-select
				[(ngModel)]="value"
				(ngModelChange)="updateUnits($event)"
				typeaheadDebounceInterval="1000"
				[disabled]="editingDisabled"
				class="unit-selector">
				<mat-option
					*ngFor="let option of units | async"
					[value]="option">
					{{ option }}
				</mat-option>
			</mat-select>
		</ng-container>
	</ng-container>
</mat-form-field>
