<!--
 * Copyright (c) 2021 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<table mat-table [dataSource]="dataSource" class="message-element-interface-table-view-element mat-elevation-z8 message-element-interface-table-view-width-100">
    <ng-container [matColumnDef]="header" *ngFor="let header of subMessageHeaders;let j=index;trackBy:valueTracker">
     <th mat-header-cell *matHeaderCellDef class="message-element-interface-table-view-sub-message-header" [matTooltip]="(getHeaderByName(header)|async)?.description||''">{{(getHeaderByName(header)|async)?.humanReadable||''}}</th>
     <td mat-cell *matCellDef="let element" class="message-element-interface-table-center" [ngClass]="!element.added && !element.deleted &&element.changes!==undefined && element.changes[header]!==undefined?'message-element-table-element-attribute-changed':''" [ngStyle]="header==='description'||header==='EnumLiteralsDesc'||header==='notes'?{
        'width':(layout|async)?.tableRecommendations?.width,
        'white-space': 'nowrap',
        'overflow': 'hidden',
        'text-overflow': 'ellipsis'
    }:{}" (contextmenu)="openGeneralMenu($event, element,header,element[header])">
        <app-sub-element-table-row [header]="header" [editMode]="editMode" [element]="element" [structure]="structure" (menu)="openGeneralMenu($event.event,element,header,element[header])"></app-sub-element-table-row>
     </td>
    </ng-container>
    <ng-container matColumnDef="footer">
        <td mat-footer-cell *matFooterCellDef [attr.colspan]="subMessageHeaders.length" style="text-align:right"></td>
    </ng-container>
 <tr mat-header-row *matHeaderRowDef="subMessageHeaders; sticky:true"></tr>    
 <tr mat-row *matRowDef= "let row2; columns: subMessageHeaders; let k=index;"
 [ngClass]="k%2===0?row2.added?'message-table-sub-element-row-even-added':row2.deleted?'message-table-sub-element-row-even-deleted': 'message-table-sub-element-row-even':row2.added?'message-table-sub-element-row-odd-added': row2.deleted?'message-table-sub-element-row-odd-deleted':'message-table-sub-element-row-odd'"></tr><!--(contextmenu)="openGeneralMenu($event,row2)"-->
 <tr mat-footer-row *matFooterRowDef="['footer']"></tr>
</table>
<mat-menu #generalMenu="matMenu">
    <ng-template matMenuContent let-element="element" let-structure="structure" let-field="field" let-header="header">
        <ng-container *ngIf="_branchType !== undefined && _branchId!==undefined">
            <a mat-menu-item [routerLink]="'/ple/messaging/'+_branchType+'/'+_branchId+'/types/'+element.platformTypeName2"><mat-icon>subdirectory_arrow_right</mat-icon>Open Platform Type</a>
            <a mat-menu-item target="_blank" [routerLink]="'/ple/messaging/'+_branchType+'/'+_branchId+'/types/'+element.platformTypeName2"><mat-icon color="primary">open_in_new</mat-icon>Open Platform Type in new tab</a>
        </ng-container>
        <ng-container *ngIf="element.logicalType==='enumeration'">
            <button mat-menu-item (click)="openEnumDialog(element.platformTypeId)"><mat-icon color="primary">toc</mat-icon>Open Enumeration Details</button>
        </ng-container>
        <button mat-menu-item (click)="openDescriptionDialog(element.description,element.id,structure.id)"><mat-icon color="primary">description</mat-icon>Open Description</button>
        <button mat-menu-item (click)="openNotesDialog(element.notes,element.id,structure.id)"><mat-icon color="primary">notes</mat-icon>Open Notes</button>
        <ng-container *ngIf="(getHeaderByName(header)|async)?.humanReadable||'' as headername">
            <ng-container *ngIf="element.changes!==undefined && element.changes[header]!==undefined && element.changes[header]!==true && element.changes[header]!==false">
                <button mat-menu-item (click)="viewDiff(element.changes[header],headername)"><mat-icon color="accent">pageview</mat-icon>View Diff</button>
            </ng-container>
        </ng-container>
        <ng-container *ngIf='editMode===true &&!element.deleted'>
            <button mat-menu-item (click)="removeElement(element,structure)"><mat-icon color="warn">remove_circle_outline</mat-icon>Remove element from structure</button>
            <button mat-menu-item (click)="deleteElement(element)"><mat-icon color="warn">delete_forever</mat-icon>Delete element globally</button>
        </ng-container>
    </ng-template>
</mat-menu>
<div #generalMenuTrigger="matMenuTrigger" style="visibility: hidden; position: fixed;" 
[style.left]="menuPosition.x" 
[style.top]="menuPosition.y" 
[matMenuTriggerFor]="generalMenu"></div>
