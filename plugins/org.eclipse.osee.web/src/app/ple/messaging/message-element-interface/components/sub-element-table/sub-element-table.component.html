<!--
 * Copyright (c) 2021 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<table mat-table [dataSource]="dataSource" class="message-element-interface-table-view-element mat-elevation-z9 message-element-interface-table-view-width-100">
    <ng-container [matColumnDef]="subHeader" *ngFor="let subHeader of subMessageHeaders;let j=index;trackBy:valueTracker">
     <th mat-header-cell *matHeaderCellDef class="message-element-interface-table-view-sub-message-header">{{subHeader | convertMessageInterfaceTitlesToString}}</th>
     <td mat-cell *matCellDef="let value" class="message-element-interface-table-center" [ngStyle]="subHeader==='description'||subHeader==='EnumLiteralsDesc'||subHeader==='notes'?{
        'width':(layout|async)?.tableRecommendations?.width,
        'white-space': 'nowrap',
        'overflow': 'hidden',
        'text-overflow': 'ellipsis'
    }:{}">
        <ng-container *ngIf="editMode===true; else no_edit">
            <ng-container *ngIf="subHeader==='platformTypeName2'">
                <osee-messaging-edit-element-field [header]="subHeader" [structureId]="element.id" [elementId]="value['id']" [elementStart]="value['interfaceElementIndexStart']" [elementEnd]="value['interfaceElementIndexEnd']" [value]="value['platformTypeName2'].toString()" (contextMenu)="openGeneralMenu($event,value)"></osee-messaging-edit-element-field>
            </ng-container>
            <ng-container *ngIf="subHeader!=='platformTypeName2'">
                <ng-container *ngIf="editableElementHeaders.includes(subHeader);else no_edit">
                    <osee-messaging-edit-element-field [header]="subHeader" [structureId]="element.id" [elementId]="value['id']" [elementStart]="value['interfaceElementIndexStart']" [elementEnd]="value['interfaceElementIndexEnd']" [value]="value[subHeader]"></osee-messaging-edit-element-field>
                </ng-container>
            </ng-container>
        </ng-container>
        <ng-template #no_edit>
            <!-- <div *ngIf="subHeader==='description'||subHeader==='EnumLiteralsDesc'||subHeader==='notes'" [matTooltip]="value[subHeader]" [matTooltipDisabled]="value[subHeader].length<15" appHighlightFilteredText [searchTerms]="filter" [text]="value[subHeader] | displayTruncatedStringWithFieldOverflow:(15+(16-subMessageHeaders.length)*4)" classToApply="ple-message-element-interface-table-highlighted-text">
            </div> -->
            <div *ngIf="subHeader==='description'||subHeader==='EnumLiteralsDesc'||subHeader==='notes'" appHighlightFilteredText [searchTerms]="filter" [text]="value[subHeader]" classToApply="ple-message-element-interface-table-highlighted-text" [ngStyle]="{
                'width':(layout|async)?.tableRecommendations?.width,
                'white-space': 'nowrap',
                'overflow': 'hidden',
                'text-overflow': 'ellipsis'
            }">
                {{value[subHeader]}}
            </div>
            <div *ngIf="subHeader!=='notes' &&subHeader!=='platformTypeName2' && subHeader!=='name' && subHeader !=='description' && subHeader !=='applicability'" appHighlightFilteredText [searchTerms]="filter" [text]="value[subHeader]" classToApply="ple-message-element-interface-table-highlighted-text">
                <!-- subHeader!=='description'&&subHeader!=='EnumLiteralsDesc'&& -->
                {{value[subHeader]}}
            </div>
            <div *ngIf="subHeader==='name'">
                <ng-container *ngIf="value['interfaceElementIndexEnd']-value['interfaceElementIndexStart']>0">
                    <div appHighlightFilteredText [searchTerms]="filter" [text]="value[subHeader]+'['+value['interfaceElementIndexStart']+'...'+value['interfaceElementIndexEnd']+']'" classToApply="ple-message-element-interface-table-highlighted-text"></div>
                </ng-container>
                <ng-container *ngIf="value['interfaceElementIndexEnd']-value['interfaceElementIndexStart']<=0">
                    <div appHighlightFilteredText [searchTerms]="filter" [text]="value[subHeader]" classToApply="ple-message-element-interface-table-highlighted-text"></div>
                </ng-container>
            </div>
            <ng-container *ngIf="subHeader==='platformTypeName2'">
                <button mat-stroked-button (click)="navigateTo(value[subHeader])" (contextmenu)="openGeneralMenu($event,value)">
                    {{value[subHeader]}}
                </button>
            </ng-container>
            <ng-container *ngIf="subHeader==='applicability'">
                <ng-container *ngIf="value[subHeader].name !== 'Base'">
                    {{value[subHeader].name}}
                </ng-container>
            </ng-container>
        </ng-template>
     </td>
    </ng-container>
    <ng-container matColumnDef="footer">
        <td mat-footer-cell *matFooterCellDef [attr.colspan]="subMessageHeaders.length" style="text-align:right">
            <ng-container *ngIf="editMode===true;">
                <button mat-mini-fab color="primary" (click)="openAddElementDialog()">+</button>
            </ng-container>
         </td>
    </ng-container>
 <tr mat-header-row *matHeaderRowDef="subMessageHeaders; sticky:true"></tr>    
 <tr mat-row *matRowDef= "let row2; columns: subMessageHeaders; let k=index;"
 [ngClass]="k%2===0? 'message-table-sub-element-row-even':'message-table-sub-element-row-odd'" (contextmenu)="openGeneralMenu($event,row2)"></tr>
 <tr mat-footer-row *matFooterRowDef="['footer']"></tr>
</table>
<mat-menu #generalMenu="matMenu">
    <ng-template matMenuContent let-element="element" let-structure="structure">
        <button mat-menu-item (click)="navigateTo(element.platformTypeName2)">Open Platform Type</button>
        <button mat-menu-item (click)="navigateToInNewTab(element.platformTypeName2)">Open Platform Type in new tab</button>
        <ng-container *ngIf='editMode===true'>
            <button mat-menu-item (click)="removeElement(element,structure)">Remove element from structure</button>
            <button mat-menu-item (click)="deleteElement(element)">Delete element globally</button>
        </ng-container>
    </ng-template>
</mat-menu>
<div #generalMenuTrigger="matMenuTrigger" style="visibility: hidden; position: fixed;" 
[style.left]="menuPosition.x" 
[style.top]="menuPosition.y" 
[matMenuTriggerFor]="generalMenu"></div>
