<!--
 * Copyright (c) 2022 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<h1 mat-dialog-title>Create New Platform Type</h1>
<mat-horizontal-stepper #stepper linear="true" class ="new-platform-type-stepper">
    <mat-step label="Select a logical type" [completed]="type.length !== 0">
        <mat-dialog-content>
            <mat-form-field>
                <mat-label>Logical Type</mat-label>
                <mat-select [(ngModel)]="type" (selectionChange)="setType($event.value)" data-cy="logical-type-selector">
                    <osee-mat-option-loading [options]="logicalTypes" [objectName]="'Logical Types'">
                        <mat-option *ngFor="let logicaltype of (logicalTypes |async)" [value]="logicaltype.id" [attr.data-cy]="'logical-type-'+logicaltype.name">
                            {{logicaltype.name |titlecase}}
                        </mat-option>
                    </osee-mat-option-loading>
                </mat-select>
            </mat-form-field>
        </mat-dialog-content>
        <mat-dialog-actions align="end">
            <button mat-button matStepperNext [disabled]="type.length === 0" data-cy="stepper-next-1">Next</button>
        </mat-dialog-actions>
    </mat-step>
    <mat-step label="Fill out type information" [completed]="isStep2Complete|async">
        <mat-dialog-content>
            <ng-container *ngIf="type!==''">
                <osee-new-type-form [logicalType]="type" (attributesUnique)="attributesUnique($event)" (stepComplete)="step2Complete($event)" (attributes)="attributesUpdate($event)" (fields)="fieldsUpdate($event)"></osee-new-type-form>
            </ng-container>
            <ng-container *ngIf="typeName==='enumeration'">
                <ng-container *ngIf="(createNewEnum|async)!==true">
                    <mat-form-field>
                        <mat-label>Select an Enumeration Set</mat-label>
                        <mat-select [(ngModel)]="enumSet" [compareWith]="compareEnumSet">
                            <osee-mat-option-loading [options]="enumSets" [objectName]="'Enumeration Sets'">
                                <mat-option *ngFor="let enumset of (enumSets|async)" [value]="enumset">
                                    {{enumset.name}}
                                </mat-option>
                            </osee-mat-option-loading>
                        </mat-select>
                        <button mat-icon-button matSuffix (click)="toggleEnumCreationState($event)"><mat-icon>{{(createNewEnum|async)!==true?'add':'remove'}}</mat-icon>
                        </button>
                    </mat-form-field>
                </ng-container>
                <div [@detailExpand]="(createNewEnum|async)===true && typeName==='enumeration' ? 'expanded':'collapsed'">
                    <ng-container *ngIf="(createNewEnum|async)===true">
                        <ng-container *ngIf="attributes|async as attrs; else NoBitSize">
                            <osee-enum-set-form [bitSize]="attrs.get('Bit Size')||'0'" (enumSet)="updateEnumSet($event)" (unique)="enumSetUnique($event)" (close)="toggleEnumCreationState()"></osee-enum-set-form>
                        </ng-container>
                        <ng-template #NoBitSize>
                            No Bit Size defined, please select a bit size above.
                        </ng-template>
                    </ng-container>
                </div>
            </ng-container>
        </mat-dialog-content>
        <mat-dialog-actions align="end">
            <button mat-button matStepperPrevious>Back</button>
            <ng-container *ngIf="(isStep2Complete|async)">
                <button mat-raised-button matStepperNext [disabled]="(isStep2Complete|async)===false || (isUnique|async)===false" [color]="(isStep2Complete|async)===true ? 'primary': ''" data-cy="stepper-next-2">Next</button>
            </ng-container>
        </mat-dialog-actions>
    </mat-step>
    <mat-step label="Summary">
        <mat-dialog-content>
            <p class="mat-headline">
                A new platform type of type {{(formInfo |async)?.name | titlecase}} will be created with the following properties:
            </p>
            <br>
            <ng-container *ngIf="attributes|async as attrs">
                <ng-container *ngFor="let attr of attrs |keyvalue">
                    <mat-label class="mat-title"> {{attr.key}} : {{attr.value}}</mat-label>
                    <br>
                </ng-container>
            </ng-container>
            <br>
            <ng-container *ngFor="let field of fields">
                <ng-container *ngIf="field.value!==''">
                    <mat-label class="mat-title">{{field.name}} : {{field.value}}</mat-label>
                    <br>
                </ng-container>
            </ng-container>
        </mat-dialog-content>
        <mat-dialog-actions align="end">
            <button mat-button matStepperPrevious>Back</button>
            <button mat-raised-button color="primary" *ngIf="!disableClose" [mat-dialog-close]="closeDialog()" data-cy="close-new-platform-menu">
                Ok
            </button>
            <button mat-raised-button color="primary" *ngIf="disableClose" (click)="hideTypeDialog()">
                Create Type
            </button>
        </mat-dialog-actions>
    </mat-step>
</mat-horizontal-stepper>
