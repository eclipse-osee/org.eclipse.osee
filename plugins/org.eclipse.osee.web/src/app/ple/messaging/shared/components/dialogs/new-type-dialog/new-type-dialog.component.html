<!--
 * Copyright (c) 2022 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<h1 mat-dialog-title>Create New Platform Type</h1>
<mat-horizontal-stepper #stepper linear="true" class ="new-platform-type-stepper">
    <mat-step label="Select a logical type" [completed]="type.length !== 0">
        <mat-dialog-content>
            <mat-form-field>
                <mat-label>Logical Type</mat-label>
                <mat-select [(ngModel)]="type" (selectionChange)="setType($event.value)" data-cy="logical-type-selector">
                    <mat-option *ngFor="let logicaltype of (logicalTypes |async)" [value]="logicaltype.id" [attr.data-cy]="'logical-type-'+logicaltype.name">
                        {{logicaltype.name |titlecase}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </mat-dialog-content>
        <mat-dialog-actions align="end">
            <button mat-button matStepperNext [disabled]="type.length === 0" data-cy="stepper-next-1">Next</button>
        </mat-dialog-actions>
    </mat-step>
    <mat-step label="Fill out type information" [completed]="isStep2Complete()">
        <mat-dialog-content>
            <mat-label class="mat-headline">Set fields for new type based on logical type {{(formInfo |async)?.name | titlecase}}</mat-label>
            <br>
            <ng-container *ngFor="let form of (formInfo | async)?.fields; index as i">
                <ng-container *ngIf="form.editable">
                    <ng-container *ngIf="form.name==='Units'; else genericInput">
                        <mat-form-field>
                            <mat-label>{{form.name}}</mat-label>
                            <mat-select [(ngModel)]="fields[i].value" #input [required]="form.required" [attr.data-cy]="'field-'+form.attributeType">
                                <mat-option *ngFor="let unit of (units|async)" [value]="unit">
                                    {{unit}}
                                </mat-option>
                                <ng-container *ngIf="form.defaultValue">
                                    <mat-hint align="end">Default Value: {{form.defaultValue}}</mat-hint>
                                </ng-container>
                            </mat-select>
                        </mat-form-field>
                    </ng-container>
                    <ng-template #genericInput>
                        <mat-form-field>
                            <mat-label>{{form.name}}</mat-label>
                            <input matInput type="text" [(ngModel)]="fields[i].value" #input [required]="form.required" [attr.data-cy]="'field-'+form.attributeType">
                            <ng-container *ngIf="form.defaultValue">
                                <mat-hint align="end">Default Value: {{form.defaultValue}}</mat-hint>
                            </ng-container>
                        </mat-form-field>
                    </ng-template>
                    <br>
                </ng-container>
                <ng-container *ngIf="!form.editable">
                    {{setDefaultValue(form,i)}}
                </ng-container>
            </ng-container>
            <ng-container *ngIf="getTypeName()==='enumeration'">
                <mat-form-field>
                    <ng-container *ngIf="(createNewEnum|async)!==true; else createEnumName">
                        <mat-label>Select an Enumeration Set</mat-label>
                        <mat-select [(ngModel)]="enumSet" [compareWith]="compareEnumSet">
                            <mat-option *ngFor="let enumset of (enumSets|async)" [value]="enumset">
                                {{enumset.name}}
                            </mat-option>
                        </mat-select>
                    </ng-container>
                    <ng-template #createEnumName>
                        <mat-label>Enter Enum Set Name</mat-label>
                        <input matInput [(ngModel)]="enumSet.name">
                    </ng-template>
                    <button mat-icon-button matSuffix (click)="toggleEnumCreationState()"><mat-icon>{{(createNewEnum|async)!==true?'add':'remove'}}</mat-icon>
                    </button>
                </mat-form-field>
                <div [@detailExpand]="(createNewEnum|async)===true && getTypeName()==='enumeration' ? 'expanded':'collapsed'">
                    <ng-container *ngIf="(createNewEnum|async)===true">
                        <br>
                        <mat-form-field>
                            <mat-label>Enter Enum Set Description</mat-label>
                            <input matInput [(ngModel)]="enumSet.description">
                        </mat-form-field>
                        <br>
                        <mat-form-field id='connection-applicability-selector'>
                            <mat-label>Select an Applicability</mat-label>
                            <mat-select [(ngModel)]="enumSet.applicability" [compareWith]="compareApplics" required>
                                <mat-option *ngFor="let applic of (applics|async)" [value]="applic">
                                    {{applic.name}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                        <br>
                        Enums:
                        <table mat-table [dataSource]="dataSource">
                            <ng-container matColumnDef="name">
                                <th mat-header-cell *matHeaderCellDef>Name</th>
                                <td mat-cell *matCellDef="let element">
                                    <mat-form-field>
                                        <mat-label>Enter a name</mat-label>
                                        <input matInput [(ngModel)]="element.name">
                                    </mat-form-field>
                                </td>
                                <td mat-footer-cell *matFooterCellDef></td>
                            </ng-container>
                            <ng-container matColumnDef="ordinal">
                                <th mat-header-cell *matHeaderCellDef>Ordinal</th>
                                <td mat-cell *matCellDef="let element">
                                    <mat-form-field>
                                        <mat-label>Enter an ordinal</mat-label>
                                        <input matInput [(ngModel)]="element.ordinal" type="number">
                                    </mat-form-field>
                                </td>
                                <td mat-footer-cell *matFooterCellDef></td>
                            </ng-container>
                            <ng-container matColumnDef="applicability">
                                <th mat-header-cell *matHeaderCellDef>Applicability</th>
                                <td mat-cell *matCellDef="let element">
                                    <mat-form-field id='connection-applicability-selector'>
                                        <mat-label>Select an Applicability</mat-label>
                                        <mat-select [(ngModel)]="element.applicability" [compareWith]="compareApplics" required>
                                            <mat-option *ngFor="let applic of (applics|async)" [value]="applic">
                                                {{applic.name}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </td>
                                <td mat-footer-cell *matFooterCellDef>
                                    <button mat-button (click)="addEnum()" [disabled]="validateEnumLengthIsBelowMax()">+</button>
                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="['name','ordinal','applicability']"></tr>
                            <tr mat-row *matRowDef="let row; columns: ['name','ordinal','applicability'];"></tr>
                            <tr mat-footer-row *matFooterRowDef="['name','ordinal','applicability']"></tr>
                        </table>
                    </ng-container>
                </div>
            </ng-container>
        </mat-dialog-content>
        <mat-dialog-actions align="end">
            <button mat-button matStepperPrevious>Back</button>
            <ng-container *ngIf="isStep2Complete()">
                <button mat-raised-button matStepperNext [disabled]="!isStep2Complete()" [color]="isStep2Complete() ? 'primary': ''" data-cy="stepper-next-2">Next</button>
            </ng-container>
            <ng-container *ngIf="!isStep2Complete()">
                <button mat-button matStepperNext [disabled]="!isStep2Complete()" [color]="isStep2Complete() ? 'primary': ''">Next</button>
            </ng-container>
        </mat-dialog-actions>
    </mat-step>
    <mat-step label="Summary">
        <mat-dialog-content>
            <p class="mat-headline">
                A new platform type of type {{(formInfo |async)?.name | titlecase}} will be created with the following properties:
            </p>
            <br>
            <br>
            <ng-container *ngFor="let field of fields">
                <ng-container *ngIf="field.value!==''">
                    <mat-label class="mat-title">{{field.name}} : {{field.value}}</mat-label>
                    <br>
                </ng-container>
            </ng-container>
        </mat-dialog-content>
        <mat-dialog-actions align="end">
            <button mat-button matStepperPrevious>Back</button>
            <button mat-raised-button color="primary" *ngIf="!disableClose" [mat-dialog-close]="closeDialog()" data-cy="close-new-platform-menu">
                Ok
            </button>
            <button mat-raised-button color="primary" *ngIf="disableClose" (click)="hideTypeDialog()">
                Create Type
            </button>
        </mat-dialog-actions>
    </mat-step>
</mat-horizontal-stepper>
