<!--
 * Copyright (c) 2021 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<div class="mat-elevation-z8">
	<osee-typesearch-element-table-search></osee-typesearch-element-table-search>
	<table
		mat-table
		multiTemplateDataRows
		[dataSource]="dataSource"
		class="tw-w-full">
		<ng-container
			[matColumnDef]="header"
			*ngFor="
				let header of headers;
				let i = index;
				trackBy: valueTracker
			">
			<th
				mat-header-cell
				*matHeaderCellDef
				[attr.colspan]="headers[i]"
				class="tw-text-primary-600">
				<ng-container *ngIf="header !== 'paths'; else path">
					{{ getHumanReadable(header) | async }}
				</ng-container>
				<ng-template #path> Connection View </ng-template>
			</th>
			<td
				mat-cell
				*matCellDef="let element; let i = dataIndex">
				<ng-container
					*ngIf="
						header === 'notes' || header === 'description';
						else noShrink
					">
					{{
						element[header]
							| displayTruncatedStringWithFieldOverflow: 15
					}}
				</ng-container>
				<ng-template #noShrink>
					<ng-container *ngIf="header !== 'paths'; else pathButton">
						<ng-container *ngIf="isPlatformType(element[header])">
							{{ element[header].name }}
						</ng-container>
						<ng-container *ngIf="!isPlatformType(element[header])">
							{{ element[header] }}
						</ng-container>
					</ng-container>
					<ng-template #pathButton>
						<ng-container *ngIf="element.paths.length === 1">
							<ng-container *ngIf="branchType | async as _type">
								<ng-container *ngIf="branchId | async as _id">
									<a
										mat-button
										[routerLink]="
											'/ple/messaging/connections/' +
											_type +
											'/' +
											_id +
											'/-1/' +
											element.paths[0]
										"
										>Go to</a
									>
								</ng-container>
							</ng-container>
						</ng-container>
						<ng-container *ngIf="element.paths.length > 1">
							<button
								mat-button
								[matMenuTriggerFor]="routeMenu"
								[matMenuTriggerData]="{
									paths: element.paths,
									names: element.buttonNames
								}">
								Go to
							</button>
						</ng-container>
					</ng-template>
				</ng-template>
			</td>
		</ng-container>
		<tr
			mat-header-row
			*matHeaderRowDef="headers; sticky: true"></tr>
		<tr
			mat-row
			*matRowDef="let row; columns: headers"
			class="even-multi:tw-bg-background-background odd-multi:tw-bg-background-selected-button"></tr>
	</table>
</div>
<mat-menu #routeMenu>
	<ng-template
		matMenuContent
		let-paths="paths"
		let-names="names">
		<ng-container *ngIf="branchType | async as _type">
			<ng-container *ngIf="branchId | async as _id">
				<ng-container *ngFor="let path of paths; index as i">
					<a
						mat-button
						[routerLink]="
							'/ple/messaging/connections/' +
							_type +
							'/' +
							_id +
							'/-1/' +
							path +
							'/.'
						"
						class="tw-h-auto"
						>{{ names[i] }}</a
					>
				</ng-container>
			</ng-container>
		</ng-container>
	</ng-template>
</mat-menu>
