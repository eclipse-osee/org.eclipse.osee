<!--
 * Copyright (c) 2022 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<div class="branch-controls">
    <osee-branch-picker category="3"></osee-branch-picker>
    <action-dropdown category="3" workType="MIM"></action-dropdown>
</div>
<ng-container *ngIf="(branchId|async) as _branch">
    <ng-container *ngIf="_branch !== '0' && _branch !== ' '">
        <ng-container *ngIf="(branchType|async) as _branchType">
            <ng-container *ngIf="_branchType === 'working'; else branchTypeMessage">
                <ng-container *ngIf="(importOptions | async) as _importOptions">
                    <div class="import-form-container">
                        <h2>Import</h2>
                        <mat-form-field appearance="fill">
                            <mat-label>{{importOptionSelectionText|async}}</mat-label>
                            <mat-select (selectionChange)="selectImportOption($event)" [disabled]="_importOptions.length===0" [value]="(importOptionSelection|async)">
                                <mat-option *ngFor="let option of _importOptions" [value]="option" [id]="option.id">
                                    {{option.name}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                        <ng-container *ngIf="(importOptionSelection|async)">
                            <label for="file-upload" class="input-label">
                                <button mat-raised-button color="primary">Select File</button>
                            </label>
                            <input id="file-upload" type="file" (change)="selectFile($event)" accept=".xls">
                            <ng-container *ngIf="(importSuccess|async) as _importSuccess; else summary">
                                <div class="import-summary">
                                    <ng-container *ngIf="_importSuccess">
                                        <p>Import successful</p>
                                    </ng-container>
                                    <ng-container *ngIf="!_importSuccess">
                                        <p>Import failed</p>
                                    </ng-container>
                                </div>
                            </ng-container>
                            <ng-template #summary>
                                <ng-container *ngIf="(importSummary|async) as _importSummary">
                                    <div class="import-summary">
                                        <h3>The following will be imported from {{selectedImportFileName|async}}</h3>
                                        <p>Node: {{_importSummary.primaryNode.name}}</p>
                                        <p>Node: {{_importSummary.secondaryNode.name}}</p>
                                        <p>Connection: {{_importSummary.primaryNode.name}}_{{_importSummary.secondaryNode.name}}</p>
                                        <p>Messages: {{_importSummary.messages.length}}</p>
                                        <p>SubMessages: {{_importSummary.subMessages.length}}</p>
                                        <p>Structures: {{_importSummary.structures.length}}</p>
                                        <p>Elements: {{_importSummary.elements.length}}</p>
                                        <p>Platform Types: {{_importSummary.platformTypes.length}}</p>
                                        <p>Enum Sets: {{_importSummary.enumSets.length}}</p>
                                        <p>Enums: {{_importSummary.enums.length}}</p>
                                    </div>
                                    <button mat-raised-button color="primary" (click)="performImport()" [disabled]="!_importSummary">Import</button>
                                </ng-container>
                            </ng-template>
                        </ng-container>
                    </div>
                </ng-container>
            </ng-container>
            <ng-template #branchTypeMessage>
                <div class="import-form-container">
                    <p>Can only import to a working branch</p>
                </div>
            </ng-template>
        </ng-container>
    </ng-container>
</ng-container>
