<!--
 * Copyright (c) 2022 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<osee-messaging-controls [actionControls]="true"></osee-messaging-controls>
<ng-container *ngIf="branchId | async as _branch">
	<ng-container *ngIf="_branch !== '0' && _branch !== ' '">
		<ng-container *ngIf="branchType | async as _branchType">
			<ng-container
				*ngIf="_branchType === 'working'; else branchTypeMessage">
				<ng-container *ngIf="importOptions | async as _importOptions">
					<div class="import-form-container">
						<h2>Import</h2>
						<div class="form-fields-container">
							<mat-form-field appearance="fill">
								<mat-label>{{
									importOptionSelectionText | async
								}}</mat-label>
								<mat-select
									(selectionChange)="
										selectImportOption($event)
									"
									[disabled]="_importOptions.length === 0"
									[value]="importOptionSelection | async">
									<mat-option
										*ngFor="let option of _importOptions"
										[value]="option"
										[id]="option.id">
										{{ option.name }}
									</mat-option>
								</mat-select>
							</mat-form-field>
							<ng-container
								*ngIf="connections | async as _connections">
								<mat-form-field
									*ngIf="
										(importOptionSelection | async)
											?.connectionRequired
									"
									class="form-field"
									appearance="fill">
									<mat-label>{{
										connectionSelectionText | async
									}}</mat-label>
									<mat-select
										[ngModel]="selectedConnection | async"
										(ngModelChange)="
											setSelectedConnection($event)
										"
										[disabled]="_connections.length === 0">
										<mat-option
											*ngFor="let option of _connections"
											[value]="option"
											[id]="option.id!">
											{{ option.name }}
										</mat-option>
									</mat-select>
								</mat-form-field>
							</ng-container>
						</div>
						<ng-container
							*ngIf="importOptionSelection | async as option">
							<ng-container
								*ngIf="
									!option.connectionRequired ||
									(option.connectionRequired &&
										(selectedConnectionId | async) !== '')
								">
								<div class="tw-flex tw-items-center">
									<label
										for="file-upload"
										class="input-label">
										<button
											mat-raised-button
											color="primary"
											class="tw-m-auto">
											Select File
										</button>
									</label>
									<input
										id="file-upload"
										type="file"
										(change)="selectFile($event)"
										accept=".xlsx, .xls, .json, .zip"
										class="tw-hidden" />
									<ng-container
										*ngIf="selectedFile | async as file">
										<div class="-tw-ml-12">
											Selected:
											<span class="tw-font-bold">{{
												file.name
											}}</span>
										</div>
									</ng-container>
								</div>
							</ng-container>
							<ng-container
								*ngIf="
									(selectedFile | async) &&
									(importSuccess | async) === undefined
								">
								<button
									mat-raised-button
									color="primary"
									(click)="startImportSummary()">
									Get Import Summary
								</button>
							</ng-container>
							<ng-container
								*ngIf="
									importSuccess | async as _importSuccess;
									else summary
								">
								<div class="import-summary">
									<ng-container *ngIf="_importSuccess">
										<p>Import successful</p>
									</ng-container>
									<ng-container *ngIf="!_importSuccess">
										<p>Import failed</p>
									</ng-container>
								</div>
							</ng-container>
							<ng-template #summary>
								<ng-container
									*ngIf="
										importSummary | async as _importSummary
									">
									<ng-container *ngIf="showSummary">
										<div class="import-summary">
											<h3>
												The following will be imported
												from
												<span class="tw-font-bold">{{
													selectedImportFileName
														| async
												}}</span>
											</h3>
											<ng-container
												*ngIf="
													_importSummary.nodes
														.length > 0
												">
												<osee-import-table
													[data]="
														_importSummary.nodes
													"
													[headers]="nodeHeaders"
													[headerDetails]="
														nodeHeaderDetails
													"
													[tableTitle]="
														'Nodes'
													"></osee-import-table>
											</ng-container>
											<ng-container
												*ngIf="
													_importSummary.connections
														.length > 0
												">
												<osee-import-table
													[data]="
														_importSummary.connections
													"
													[headers]="
														connectionHeaders
													"
													[headerDetails]="
														connectionHeaderDetails
													"
													[tableTitle]="
														'Connections'
													"></osee-import-table>
											</ng-container>
											<ng-container
												*ngIf="
													_importSummary.messages
														.length > 0
												">
												<osee-import-table
													[data]="
														_importSummary.messages
													"
													[headers]="messageHeaders"
													[headerDetails]="
														messageHeaderDetails
													"
													[tableTitle]="
														'Messages'
													"></osee-import-table>
											</ng-container>
											<ng-container
												*ngIf="
													_importSummary.subMessages
														.length > 0
												">
												<osee-import-table
													[data]="
														_importSummary.subMessages
													"
													[headers]="
														submessageHeaders
													"
													[headerDetails]="
														submessageHeaderDetails
													"
													[tableTitle]="
														'SubMessages'
													"></osee-import-table>
											</ng-container>
											<ng-container
												*ngIf="
													_importSummary.structures
														.length > 0
												">
												<osee-import-table
													[data]="
														_importSummary.structures
													"
													[headers]="structureHeaders"
													[headerDetails]="
														structureHeaderDetails
													"
													[tableTitle]="
														'Structures'
													"></osee-import-table>
											</ng-container>
											<ng-container
												*ngIf="
													_importSummary.elements
														.length > 0
												">
												<osee-import-table
													[data]="
														_importSummary.elements
													"
													[headers]="elementHeaders"
													[headerDetails]="
														elementHeaderDetails
													"
													[tableTitle]="
														'Elements'
													"></osee-import-table>
											</ng-container>
											<ng-container
												*ngIf="
													_importSummary.platformTypes
														.length > 0
												">
												<osee-import-table
													[data]="
														_importSummary.platformTypes
													"
													[headers]="
														platformTypeHeaders
													"
													[headerDetails]="
														platformTypeHeaderDetails
													"
													[tableTitle]="
														'Platform Types'
													"></osee-import-table>
											</ng-container>
											<ng-container
												*ngIf="
													_importSummary.enumSets
														.length > 0
												">
												<osee-import-table
													[data]="
														(enumSets | async) || []
													"
													[headers]="enumSetHeaders"
													[headerDetails]="
														enumSetHeaderDetails
													"
													[tableTitle]="
														'Enum Sets'
													"></osee-import-table>
											</ng-container>
											<ng-container
												*ngIf="
													_importSummary
														.crossReferences
														.length > 0
												">
												<osee-import-table
													[data]="
														_importSummary.crossReferences
													"
													[headers]="crossRefHeaders"
													[headerDetails]="
														crossReferenceHeaderDetails
													"
													[tableTitle]="
														'Cross References'
													"></osee-import-table>
											</ng-container>
										</div>
										<button
											mat-raised-button
											color="primary"
											(click)="performImport()"
											[disabled]="!_importSummary">
											Import
										</button>
									</ng-container>
								</ng-container>
							</ng-template>
						</ng-container>
					</div>
				</ng-container>
			</ng-container>
			<ng-template #branchTypeMessage>
				<div class="import-form-container">
					<p>Can only import to a working branch</p>
				</div>
			</ng-template>
		</ng-container>
	</ng-container>
</ng-container>
