<!--
 * Copyright (c) 2022 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<div class="branch-controls">
	<osee-branch-picker category="3"></osee-branch-picker>
	<osee-action-dropdown
		category="3"
		workType="MIM"></osee-action-dropdown>
</div>
<ng-container *ngIf="branchId | async as _branch">
	<ng-container *ngIf="_branch !== '0' && _branch !== ' '">
		<ng-container *ngIf="branchType | async as _branchType">
			<ng-container
				*ngIf="_branchType === 'working'; else branchTypeMessage">
				<ng-container *ngIf="importOptions | async as _importOptions">
					<div class="import-form-container">
						<h2>Import</h2>
						<mat-form-field appearance="fill">
							<mat-label>{{
								importOptionSelectionText | async
							}}</mat-label>
							<mat-select
								(selectionChange)="selectImportOption($event)"
								[disabled]="_importOptions.length === 0"
								[value]="importOptionSelection | async">
								<mat-option
									*ngFor="let option of _importOptions"
									[value]="option"
									[id]="option.id">
									{{ option.name }}
								</mat-option>
							</mat-select>
						</mat-form-field>
						<ng-container *ngIf="importOptionSelection | async">
							<label
								for="file-upload"
								class="input-label">
								<button
									mat-raised-button
									color="primary">
									Select File
								</button>
							</label>
							<input
								id="file-upload"
								type="file"
								(change)="selectFile($event)"
								accept=".xlsx, .xls" />
							<ng-container
								*ngIf="
									importSuccess | async as _importSuccess;
									else summary
								">
								<div class="import-summary">
									<ng-container *ngIf="_importSuccess">
										<p>Import successful</p>
									</ng-container>
									<ng-container *ngIf="!_importSuccess">
										<p>Import failed</p>
									</ng-container>
								</div>
							</ng-container>
							<ng-template #summary>
								<ng-container
									*ngIf="
										importSummary | async as _importSummary
									">
									<div class="import-summary">
										<h3>
											The following will be imported from
											<span class="font-bold">{{
												selectedImportFileName | async
											}}</span>
										</h3>
										<ng-container
											*ngIf="
												_importSummary.primaryNode &&
												_importSummary.secondaryNode
											">
											<ul>
												<li>
													Primary Node:
													{{
														_importSummary
															.primaryNode.name
													}}
												</li>
												<li>
													Secondary Node:
													{{
														_importSummary
															.secondaryNode.name
													}}
												</li>
												<li>
													Connection:
													{{
														_importSummary
															.primaryNode.name
													}}_{{
														_importSummary
															.secondaryNode.name
													}}
												</li>
											</ul>
											<ng-container
												*ngIf="nodes | async as _nodes">
												<ng-container
													*ngIf="_nodes.length > 0">
													<osee-import-table
														[data]="[
															_importSummary.primaryNode,
															_importSummary.secondaryNode
														]"
														[headers]="nodeHeaders"
														[headerKey]="
															headerKeys.IMPORT_NODE
														"
														[tableTitle]="
															'Nodes'
														"></osee-import-table>
												</ng-container>
											</ng-container>
										</ng-container>
										<ng-container
											*ngIf="
												_importSummary.messages.length >
												0
											">
											<osee-import-table
												[data]="_importSummary.messages"
												[headers]="messageHeaders"
												[headerKey]="
													headerKeys.IMPORT_MESSAGE
												"
												[tableTitle]="
													'Messages'
												"></osee-import-table>
										</ng-container>
										<ng-container
											*ngIf="
												_importSummary.subMessages
													.length > 0
											">
											<osee-import-table
												[data]="
													_importSummary.subMessages
												"
												[headers]="submessageHeaders"
												[headerKey]="
													headerKeys.SUBMESSAGE
												"
												[tableTitle]="
													'SubMessages'
												"></osee-import-table>
										</ng-container>
										<ng-container
											*ngIf="
												_importSummary.structures
													.length > 0
											">
											<osee-import-table
												[data]="
													_importSummary.structures
												"
												[headers]="structureHeaders"
												[headerKey]="
													headerKeys.STRUCTURE
												"
												[tableTitle]="
													'Structures'
												"></osee-import-table>
										</ng-container>
										<ng-container
											*ngIf="
												_importSummary.elements.length >
												0
											">
											<osee-import-table
												[data]="_importSummary.elements"
												[headers]="elementHeaders"
												[headerKey]="headerKeys.ELEMENT"
												[tableTitle]="
													'Elements'
												"></osee-import-table>
										</ng-container>
										<ng-container
											*ngIf="
												_importSummary.platformTypes
													.length > 0
											">
											<osee-import-table
												[data]="
													_importSummary.platformTypes
												"
												[headers]="platformTypeHeaders"
												[headerKey]="
													headerKeys.IMPORT_PLATFORM_TYPE
												"
												[tableTitle]="
													'Platform Types'
												"></osee-import-table>
										</ng-container>
										<ng-container
											*ngIf="
												_importSummary.enumSets.length >
												0
											">
											<osee-import-table
												[data]="
													(enumSets | async) || []
												"
												[headers]="enumSetHeaders"
												[headerKey]="
													headerKeys.IMPORT_ENUM_SET
												"
												[tableTitle]="
													'Enum Sets'
												"></osee-import-table>
										</ng-container>
									</div>
									<button
										mat-raised-button
										color="primary"
										(click)="performImport()"
										[disabled]="!_importSummary">
										Import
									</button>
								</ng-container>
							</ng-template>
						</ng-container>
					</div>
				</ng-container>
			</ng-container>
			<ng-template #branchTypeMessage>
				<div class="import-form-container">
					<p>Can only import to a working branch</p>
				</div>
			</ng-template>
		</ng-container>
	</ng-container>
</ng-container>
