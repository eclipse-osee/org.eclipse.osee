<!--
 * Copyright (c) 2021 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<h1 mat-dialog-title>Create New Message</h1>
<mat-dialog-content>
	<mat-form-field>
		<label>Name</label>
		<input
			matInput
			type="text"
			[(ngModel)]="data.name"
			#input
			required
			data-cy="field-name" />
	</mat-form-field>
	<br />
	<mat-form-field>
		<label>Description</label>
		<textarea
			matInput
			cdkTextareaAutosize
			type="text"
			[(ngModel)]="data.description"
			#input
			required
			data-cy="field-description"></textarea>
	</mat-form-field>
	<br />
	<mat-form-field>
		<label>Rate</label>
		<mat-select
			[(ngModel)]="data.interfaceMessageRate"
			required
			data-cy="field-rate">
			<mat-option
				*ngFor="let option of rates | async"
				[value]="option"
				[attr.data-cy]="'option-' + option">
				{{ option }} Hz
			</mat-option>
		</mat-select>
	</mat-form-field>
	<br />
	<mat-form-field>
		<label>Periodicity</label>
		<mat-select
			[(ngModel)]="data.interfaceMessagePeriodicity"
			required
			data-cy="field-periodicity">
			<mat-option
				*ngFor="let option of periodicities | async"
				[value]="option"
				[attr.data-cy]="'option-' + option">
				{{ option }}
			</mat-option>
		</mat-select>
	</mat-form-field>
	<br />
	<mat-slide-toggle
		[(ngModel)]="data.interfaceMessageWriteAccess"
		[labelPosition]="data.interfaceMessageWriteAccess ? 'after' : 'before'"
		data-cy="field-write-access">
		<ng-container *ngIf="data.interfaceMessageWriteAccess; else read">
			Writable
		</ng-container>
		<ng-template #read> Read Only </ng-template>
	</mat-slide-toggle>
	<br />
	<mat-form-field>
		<label>Type</label>
		<mat-select
			[(ngModel)]="data.interfaceMessageType"
			required
			data-cy="field-message-type">
			<mat-option
				*ngFor="let option of types | async"
				[value]="option"
				[attr.data-cy]="'option-' + option">
				{{ option }}
			</mat-option>
		</mat-select>
	</mat-form-field>
	<br />
	<mat-form-field>
		<label>Message Number</label>
		<input
			matInput
			type="text"
			[(ngModel)]="data.interfaceMessageNumber"
			#input
			required
			data-cy="field-message-number" />
	</mat-form-field>
	<ng-container *ngIf="transportType | async as type">
		<br />
		<mat-form-field>
			<label>Publisher Node(s)</label>
			<mat-select
				[(ngModel)]="data.publisherNodes"
				required
				[multiple]="type.maximumPublisherMultiplicity !== 1"
				#pubSelect="ngModel"
				[oseeMessageNodesCount]="true"
				data-cy="field-init-node">
				<mat-option
					*ngFor="let option of nodes | async"
					[value]="option"
					[attr.data-cy]="'option-' + option.name">
					{{ option.name }}
				</mat-option>
			</mat-select>
			<mat-error
				*ngIf="
					pubSelect.control.errors?.min ||
					pubSelect.control.errors?.required
				"
				>Minimum nodes is
				{{ type.minimumPublisherMultiplicity || 1 }}</mat-error
			>
			<mat-error *ngIf="pubSelect.control.errors?.max"
				>Maximum nodes is
				{{ type.maximumPublisherMultiplicity }}</mat-error
			>
		</mat-form-field>
		<br />
		<mat-form-field>
			<label>Subscriber Node(s)</label>
			<mat-select
				[(ngModel)]="data.subscriberNodes"
				required
				[multiple]="type.maximumSubscriberMultiplicity !== 1"
				#subSelect="ngModel"
				[oseeMessageNodesCount]="false"
				data-cy="field-init-node">
				<mat-option
					*ngFor="let option of nodes | async"
					[value]="option"
					[attr.data-cy]="'option-' + option.name">
					{{ option.name }}
				</mat-option>
			</mat-select>
			<mat-error
				*ngIf="
					subSelect.control.errors?.min ||
					subSelect.control.errors?.required
				"
				>Minimum nodes is
				{{ type.minimumSubscriberMultiplicity || 1 }}</mat-error
			>
			<mat-error *ngIf="subSelect.control.errors?.max"
				>Maximum nodes is
				{{ type.maximumSubscriberMultiplicity }}</mat-error
			>
		</mat-form-field>
	</ng-container>
</mat-dialog-content>
<mat-dialog-actions align="end">
	<button
		mat-button
		(click)="onNoClick()"
		data-cy="cancel-btn">
		Cancel
	</button>
	<ng-container *ngIf="transportType | async as type">
		<button
			mat-raised-button
			[mat-dialog-close]="data"
			color="primary"
			[disabled]="
				data.name.length === 0 ||
				data.interfaceMessageNumber.length === 0 ||
				data.interfaceMessagePeriodicity.length === 0 ||
				data.interfaceMessageType.length === 0 ||
				data.interfaceMessageRate.length === 0 ||
				data.publisherNodes.length === 0 ||
				(data.publisherNodes.length > 0 &&
					data.publisherNodes[0].id === '') ||
				data.subscriberNodes.length === 0 ||
				(data.subscriberNodes.length > 0 &&
					data.subscriberNodes[0].id === '') ||
				(type.maximumPublisherMultiplicity !== 0 &&
					data.publisherNodes.length >
						type.maximumPublisherMultiplicity) ||
				(type.minimumPublisherMultiplicity !== 0 &&
					data.publisherNodes.length <
						type.minimumPublisherMultiplicity) ||
				(type.maximumSubscriberMultiplicity !== 0 &&
					data.publisherNodes.length >
						type.maximumSubscriberMultiplicity) ||
				(type.minimumSubscriberMultiplicity !== 0 &&
					data.publisherNodes.length <
						type.minimumSubscriberMultiplicity)
			"
			data-cy="submit-btn">
			Ok
		</button>
	</ng-container>
</mat-dialog-actions>
