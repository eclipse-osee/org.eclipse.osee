<!--
 * Copyright (c) 2021 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<form #addMessageForm="ngForm">
	<h1 mat-dialog-title>Create New Message</h1>
	<mat-dialog-content>
		<mat-form-field class="tw-w-full">
			<label>Name</label>
			<input
				matInput
				type="text"
				[(ngModel)]="data.name"
				#input
				required
				name="name"
				data-cy="field-name" />
		</mat-form-field>
		<br />
		<mat-form-field class="tw-w-full">
			<label>Description</label>
			<textarea
				matInput
				cdkTextareaAutosize
				type="text"
				[(ngModel)]="data.description"
				#input
				required
				name="description"
				data-cy="field-description"></textarea>
		</mat-form-field>
		<br />
		<osee-rate-dropdown
			[(rate)]="data.interfaceMessageRate"
			[required]="true"></osee-rate-dropdown>
		<br />
		<mat-form-field class="tw-w-full">
			<label>Periodicity</label>
			<mat-select
				[(ngModel)]="data.interfaceMessagePeriodicity"
				required
				name="periodicity"
				data-cy="field-periodicity">
				<mat-option
					*ngFor="let option of periodicities | async"
					[value]="option"
					[attr.data-cy]="'option-' + option">
					{{ option }}
				</mat-option>
			</mat-select>
		</mat-form-field>
		<br />
		<mat-slide-toggle
			[(ngModel)]="data.interfaceMessageWriteAccess"
			name="write_access"
			[labelPosition]="
				data.interfaceMessageWriteAccess ? 'after' : 'before'
			"
			data-cy="field-write-access"
			class="tw-w-full"
			required>
			<ng-container *ngIf="data.interfaceMessageWriteAccess; else read">
				Writable
			</ng-container>
			<ng-template #read> Read Only </ng-template>
		</mat-slide-toggle>
		<br />
		<osee-message-type-dropdown
			[(messageType)]="data.interfaceMessageType"
			[required]="true"></osee-message-type-dropdown>
		<br />
		<mat-form-field class="tw-w-full">
			<label>Message Number</label>
			<input
				matInput
				type="text"
				[(ngModel)]="data.interfaceMessageNumber"
				#input
				name="message_number"
				required
				data-cy="field-message-number" />
		</mat-form-field>
		<ng-container *ngIf="transportType | async as type">
			<br />
			<mat-form-field class="tw-w-full">
				<label>Publisher Node(s)</label>
				<mat-select
					[(ngModel)]="data.publisherNodes"
					required
					name="pub_nodes"
					[multiple]="type.maximumPublisherMultiplicity !== 1"
					#pubSelect="ngModel"
					[oseeMessageNodesCount]="true"
					data-cy="field-pub-node">
					<mat-option
						*ngFor="let option of nodes | async"
						[value]="option"
						[attr.data-cy]="'option-' + option.name">
						{{ option.name }}
					</mat-option>
				</mat-select>
				<mat-error
					*ngIf="
						pubSelect.control.errors?.min ||
						pubSelect.control.errors?.required
					"
					>Minimum nodes is
					{{ type.minimumPublisherMultiplicity || 1 }}</mat-error
				>
				<mat-error *ngIf="pubSelect.control.errors?.max"
					>Maximum nodes is
					{{ type.maximumPublisherMultiplicity }}</mat-error
				>
			</mat-form-field>
			<br />
			<mat-form-field class="tw-w-full">
				<label>Subscriber Node(s)</label>
				<mat-select
					[(ngModel)]="data.subscriberNodes"
					required
					name="sub_nodes"
					[multiple]="type.maximumSubscriberMultiplicity !== 1"
					#subSelect="ngModel"
					[oseeMessageNodesCount]="false"
					data-cy="field-sub-node">
					<mat-option
						*ngFor="let option of nodes | async"
						[value]="option"
						[attr.data-cy]="'option-' + option.name">
						{{ option.name }}
					</mat-option>
				</mat-select>
				<mat-error
					*ngIf="
						subSelect.control.errors?.min ||
						subSelect.control.errors?.required
					"
					>Minimum nodes is
					{{ type.minimumSubscriberMultiplicity || 1 }}</mat-error
				>
				<mat-error *ngIf="subSelect.control.errors?.max"
					>Maximum nodes is
					{{ type.maximumSubscriberMultiplicity }}</mat-error
				>
			</mat-form-field>
			<osee-applicability-selector
				[applicability]="data.applicability"
				(applicabilityChange)="data.applicability = $event"
				[required]="true"></osee-applicability-selector>
		</ng-container>
	</mat-dialog-content>
	<mat-dialog-actions align="end">
		<button
			mat-button
			(click)="onNoClick()"
			data-cy="cancel-btn">
			Cancel
		</button>
		<ng-container *ngIf="transportType | async as type">
			<ng-container *ngIf="type.id !== '-1'; else invalidTransportType">
				<button
					mat-raised-button
					[mat-dialog-close]="data"
					color="primary"
					[disabled]="
						addMessageForm.invalid || addMessageForm.pending
					"
					data-cy="submit-btn">
					Ok
				</button>
			</ng-container>
		</ng-container>
		<ng-template #invalidTransportType>
			<mat-error
				>Transport Type is invalid. Please contact a MIM
				admin.</mat-error
			>
		</ng-template>
	</mat-dialog-actions>
</form>
