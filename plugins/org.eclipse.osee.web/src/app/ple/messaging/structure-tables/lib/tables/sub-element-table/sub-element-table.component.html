<!--
 * Copyright (c) 2021 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<table
	mat-table
	[dataSource]="dataSource"
	class="message-element-interface-table-view-element mat-elevation-z8 message-element-interface-table-view-width-100"
	data-cy="sub-element-table">
	<ng-container
		[matColumnDef]="header"
		*ngFor="
			let header of subMessageHeaders;
			let j = index;
			trackBy: valueTracker
		">
		<th
			mat-header-cell
			*matHeaderCellDef
			class="message-element-interface-table-view-sub-message-header"
			[matTooltip]="(getHeaderByName(header) | async)?.description || ''"
			[attr.data-cy]="'element-table-header-' + header">
			{{ (getHeaderByName(header) | async)?.humanReadable || '' }}
		</th>
		<td
			mat-cell
			*matCellDef="let element"
			class="message-element-interface-table-center"
			[ngClass]="
				!element.added &&
				!element.deleted &&
				element.changes !== undefined &&
				element.changes[header] !== undefined
					? 'message-element-table-element-attribute-changed'
					: ''
			"
			(contextmenu)="
				openGeneralMenu($event, element, header, element[header])
			">
			<osee-messaging-sub-element-table-field
				[header]="header"
				[editMode]="editMode"
				[element]="element"
				[structure]="structure"
				(menu)="
					openGeneralMenu(
						$event.event,
						element,
						header,
						element[header]
					)
				"></osee-messaging-sub-element-table-field>
		</td>
	</ng-container>
	<ng-container matColumnDef="footer">
		<td
			mat-footer-cell
			*matFooterCellDef
			[attr.colspan]="subMessageHeaders.length"
			style="text-align: right"></td>
	</ng-container>
	<tr
		mat-header-row
		*matHeaderRowDef="subMessageHeaders; sticky: true"></tr>
	<tr
		mat-row
		*matRowDef="let row2; columns: subMessageHeaders; let k = index"
		[id]="'a' + row2.id"
		[attr.data-cy]="'element-table-row-' + row2.name"
		[ngClass]="
			k % 2 === 0
				? row2.added
					? 'message-table-sub-element-row-even-added'
					: row2.deleted
					? 'message-table-sub-element-row-even-deleted'
					: row2.autogenerated
					? 'message-table-sub-element-row-even-autogen'
					: 'message-table-sub-element-row-even'
				: row2.added
				? 'message-table-sub-element-row-odd-added'
				: row2.deleted
				? 'message-table-sub-element-row-odd-deleted'
				: row2.autogenerated
				? 'message-table-sub-element-row-odd-autogen'
				: 'message-table-sub-element-row-odd'
		"></tr>
	<!--(contextmenu)="openGeneralMenu($event,row2)"-->
	<tr
		mat-footer-row
		*matFooterRowDef="['footer']"
		class="element-table-row-last"></tr>
</table>
<mat-menu #generalMenu="matMenu">
	<ng-template
		matMenuContent
		let-element="element"
		let-structure="structure"
		let-field="field"
		let-header="header">
		<osee-sub-element-table-dropdown
			[element]="element"
			[structure]="structure"
			[header]="header"
			[branchId]="_branchId"
			[branchType]="_branchType"
			[field]="field"
			[editMode]="editMode"></osee-sub-element-table-dropdown>
	</ng-template>
</mat-menu>
<div
	#generalMenuTrigger="matMenuTrigger"
	style="visibility: hidden; position: fixed"
	[style.left]="menuPosition.x"
	[style.top]="menuPosition.y"
	[matMenuTriggerFor]="generalMenu"></div>
