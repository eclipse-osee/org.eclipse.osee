<!--
 * Copyright (c) 2023 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<table
	mat-table
	[dataSource]="element.arrayElements"
	cdkDropList
	[cdkDropListDisabled]="!editMode"
	(cdkDropListDropped)="handleDragDrop($event)"
	class="tw-w-full"
	[trackBy]="elementTracker"
	data-cy="sub-element-table">
	<ng-container
		[matColumnDef]="header"
		*ngFor="let header of elementHeaders">
		<th
			mat-header-cell
			*matHeaderCellDef
			class="tw-text-center tw-font-medium tw-text-primary"
			[ngClass]="{
				'tw-flex-[0_0_8%]': header === 'interfaceElementAlterable',
				'tw-flex-[0_0_10%]': header === 'platformType',
				'tw-w-1/4': header === 'platformType' && editMode,
				'tw-w-[10%]': header === 'platformType' && !editMode,
				'tw-max-w-[10%] tw-flex-[1_1_10%] tw-pr-4': header === 'name',
				'tw-flex-[3_1_content]': header === 'description'
			}"
			[matTooltip]="(getHeaderByName(header) | async)?.description || ''"
			[attr.data-cy]="'element-table-header-' + header"
			[class.edit]="editMode">
			{{ (getHeaderByName(header) | async)?.humanReadable || '' }}
		</th>
		<td
			mat-cell
			*matCellDef="let element"
			class="tw-text-center"
			[ngClass]="{
				'tw-bg-accent-100 dark:tw-text-background-app-bar dark:[&>*>*>*>*>*>*>*>*>*]:tw-text-background-app-bar dark:[&>*>*>*>*]:tw-text-background-app-bar':
					!element.added &&
					!element.deleted &&
					element.changes !== undefined &&
					element.changes[header] !== undefined,
				'tw-flex-[0_0_8%]': header === 'interfaceElementAlterable',
				'tw-flex-[0_0_10%]': header === 'platformType',
				'tw-w-1/4': header === 'platformType' && editMode,
				'tw-w-[10%]': header === 'platformType' && !editMode,
				'tw-max-w-[10%] tw-flex-[1_1_10%] tw-pr-4': header === 'name',
				'tw-flex-[3_1_content]': header === 'description'
			}"
			(contextmenu)="
				openGeneralMenu($event, element, header, element[header])
			"
			[class.edit]="editMode">
			<ng-container *ngIf="header === 'rowControls'">
				<div class="tw-flex tw-items-center">
					<ng-container
						*ngIf="editMode === true && !element.autogenerated">
						<mat-icon
							cdkDrag
							cdkDragHandle
							cdkDragLockAxis="y"
							cdkDragRootElement=".sub-element-array-drag-row"
							>reorder</mat-icon
						>
					</ng-container>
				</div>
			</ng-container>
			<ng-container *ngIf="header !== 'rowControls'">
				<osee-messaging-sub-element-table-field
					[header]="header"
					[editMode]="editMode"
					[element]="element"
					(menu)="
						openGeneralMenu(
							$event.event,
							element,
							header,
							element[header]
						)
					"></osee-messaging-sub-element-table-field>
			</ng-container>
		</td>
	</ng-container>
	<tr
		mat-header-row
		*matHeaderRowDef="elementHeaders; sticky: true"></tr>
	<tr
		mat-row
		*matRowDef="let row2; columns: elementHeaders"
		[id]="'a' + row2.id"
		[attr.data-cy]="'element-table-row-' + row2.name"
		class="sub-element-array-drag-row tw-transition-colors tw-duration-300 tw-ease-in-out"
		[ngClass]="
			row2.added
				? 'odd:tw-bg-success-200 even:tw-bg-success-100 odd:hover:tw-bg-success-300 even:hover:tw-bg-success-200 odd:dark:tw-bg-success-700 even:dark:tw-bg-success-600 odd:dark:hover:tw-bg-success-800 even:dark:hover:tw-bg-success-700'
				: row2.deleted
				? 'odd:tw-bg-warning-400 even:tw-bg-warning-300 odd:hover:tw-bg-warning-300 even:hover:tw-bg-warning-200 odd:dark:tw-bg-warning-800 even:dark:tw-bg-warning-400 odd:dark:hover:tw-bg-warning-700 even:dark:hover:tw-bg-warning-300 odd:[&>*]:tw-text-foreground-text even:[&>*]:tw-text-foreground-text odd:dark:[&>*]:tw-text-background-app-bar even:dark:[&>*]:tw-text-background-app-bar even:[&>td>*>*>*]:tw-text-foreground-text even:dark:[&>td>*>*>*]:tw-text-background-app-bar'
				: row2.autogenerated
				? 'odd:tw-bg-accent-50 even:tw-bg-accent-100 odd:hover:tw-bg-accent-100 even:hover:tw-bg-accent-200 odd:dark:tw-bg-accent-600 even:dark:tw-bg-accent-700 even:dark:tw-bg-opacity-30 odd:dark:hover:tw-bg-accent-500 even:dark:hover:tw-bg-accent-600 odd:dark:[&>*]:tw-text-background-app-bar even:dark:[&>*]:tw-text-background-app-bar even:dark:[&>td>*>*>*]:tw-text-background-app-bar'
				: 'odd:tw-bg-primary-100 even:tw-bg-primary-200 odd:hover:tw-bg-primary-200 even:hover:tw-bg-primary-300 odd:dark:tw-bg-primary-600 even:dark:tw-bg-primary-700 odd:dark:hover:tw-bg-primary-500 even:dark:hover:tw-bg-primary-600'
		"></tr>
</table>
<mat-menu #generalMenu="matMenu">
	<ng-template
		matMenuContent
		let-element="element"
		let-headerElement="headerElement"
		let-field="field"
		let-header="header">
		<osee-sub-element-array-table-dropdown
			[element]="element"
			[headerElement]="headerElement"
			[header]="header"
			[branchId]="_branchId"
			[branchType]="_branchType"
			[field]="field"
			[editMode]="editMode"></osee-sub-element-array-table-dropdown>
	</ng-template>
</mat-menu>
<div
	#generalMenuTrigger="matMenuTrigger"
	style="visibility: hidden; position: fixed"
	[style.left]="menuPosition.x"
	[style.top]="menuPosition.y"
	[matMenuTriggerFor]="generalMenu"></div>
