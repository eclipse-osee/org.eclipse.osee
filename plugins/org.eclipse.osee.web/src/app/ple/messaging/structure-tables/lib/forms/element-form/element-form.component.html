<!--
 * Copyright (c) 2023 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<form #elementForm="ngForm">
	<mat-form-field class="tw-w-full">
		<mat-label>Name</mat-label>
		<input
			matInput
			[(ngModel)]="data.element.name"
			(ngModelChange)="updateData()"
			required
			name="name"
			data-cy="field-name" />
		<mat-hint>Name of the element being created</mat-hint>
	</mat-form-field>
	<br />
	<mat-form-field class="tw-w-full">
		<mat-label>Description</mat-label>
		<textarea
			cdkTextareaAutosize
			matInput
			[(ngModel)]="data.element.description"
			(ngModelChange)="updateData()"
			name="description"
			data-cy="field-description"></textarea>
		<mat-hint>Description of the element being created</mat-hint>
	</mat-form-field>
	<br />
	<mat-form-field class="tw-w-full">
		<mat-label>Notes</mat-label>
		<textarea
			cdkTextareaAutosize
			matInput
			[(ngModel)]="data.element.notes"
			(ngModelChange)="updateData()"
			name="notes"
			data-cy="field-notes"></textarea>
		<mat-hint>Notes associated with the element being created</mat-hint>
	</mat-form-field>
	<br />
	<mat-form-field class="tw-w-full">
		<mat-label>Enum Literals</mat-label>
		<textarea
			cdkTextareaAutosize
			matInput
			[(ngModel)]="data.element.enumLiteral"
			(ngModelChange)="updateData()"
			name="enum_literal"
			data-cy="field-enum-literal"></textarea>
		<mat-hint>Enum Literals</mat-hint>
	</mat-form-field>
	<br />
	<mat-slide-toggle
		[(ngModel)]="data.element.interfaceElementAlterable"
		(ngModelChange)="updateData()"
		labelPosition="before"
		name="alterable"
		data-cy="field-alterable"
		class="tw-py-2">
		Alterable
	</mat-slide-toggle>
	<br />
	<osee-applicability-selector
		[applicability]="data.element.applicability"
		(applicabilityChange)="
			data.element.applicability = $event; updateData()
		"
		[required]="true"></osee-applicability-selector>
	<br />
	<div class="tw-flex tw-justify-evenly tw-gap-4 tw-pt-4">
		<mat-form-field
			class="tw-w-full"
			subscriptSizing="dynamic">
			<mat-label>Start Index</mat-label>
			<input
				type="number"
				matInput
				[(ngModel)]="data.element.interfaceElementIndexStart"
				(ngModelChange)="updateData()"
				required
				name="index_start"
				data-cy="field-index-start" />
			<mat-hint
				>Starting index of the element array being created(if inserting
				an array of elements)</mat-hint
			>
		</mat-form-field>
		<mat-form-field
			class="tw-w-full"
			subscriptSizing="dynamic">
			<mat-label>End Index</mat-label>
			<input
				type="number"
				matInput
				[(ngModel)]="data.element.interfaceElementIndexEnd"
				(ngModelChange)="updateData()"
				required
				name="index_end"
				data-cy="field-index-end" />
			<mat-hint
				>Ending index of the element array being created(if inserting an
				array of elements)</mat-hint
			>
		</mat-form-field>
	</div>
	<ng-container *ngIf="data.allowArray">
		<mat-slide-toggle
			*ngIf="data.mode === 'add'"
			labelPosition="before"
			name="arrayHeaderToggle"
			[(ngModel)]="data.element.interfaceElementArrayHeader"
			(ngModelChange)="toggleArrayHeader($event)"
			data-cy="field-array-header-toggle"
			class="tw-py-2">
			Array Header
		</mat-slide-toggle>
		<ng-container *ngIf="data.element.interfaceElementArrayHeader">
			<ng-container *ngIf="data.element.interfaceElementArrayHeader">
				<br />
				<mat-slide-toggle
					labelPosition="before"
					name="arrayWriteHeaderNameToggle"
					[(ngModel)]="
						data.element.interfaceElementWriteArrayHeaderName
					"
					data-cy="field-array-write-header-name-toggle"
					class="tw-py-2">
					Use Array Header Name in Reports
				</mat-slide-toggle>
			</ng-container>
			<mat-label class="tw-m-0 tw-mb-2 tw-block tw-text-foreground-base"
				>Array Elements</mat-label
			>
			<ng-container *ngFor="let e of data.element.arrayElements">
				<ng-container *ngIf="!e.autogenerated">
					<div class="tw-grid tw-grid-cols-[1fr_auto_auto] tw-pl-2">
						<div>
							{{ e.name }}
						</div>
						<button
							mat-button
							*ngIf="e.id === '' || e.id === '-1'"
							(click)="editArrayElement(e)"
							matTooltip="Edit {{ e.name }}">
							<mat-icon color="primary">edit</mat-icon>
						</button>
						<button
							mat-button
							(click)="removeFromArray(e)"
							matTooltip="Remove {{ e.name }} from array">
							<mat-icon color="warn"
								>remove_circle_outline</mat-icon
							>
						</button>
					</div>
				</ng-container>
			</ng-container>
			<button
				mat-button
				(click)="addArrayElement()">
				<mat-icon color="success">add</mat-icon>
			</button>
		</ng-container>
	</ng-container>
	<ng-container *ngIf="!data.element.interfaceElementArrayHeader">
		<ng-container
			*ngIf="
				availableTypes | async as _availableTypes;
				else loading_types
			">
			<ng-container *ngIf="_typeState | async as typeState">
				<mat-form-field
					class="tw-w-full"
					subscriptSizing="dynamic">
					<mat-label>Platform Type</mat-label>
					<mat-select
						[(ngModel)]="data.type"
						(ngModelChange)="setPlatformType($event)"
						required
						name="platform_type"
						[compareWith]="compareTypes">
						<mat-option
							*ngFor="let selectableType of _availableTypes"
							[value]="selectableType"
							[matTooltip]="selectableType.description">
							{{ selectableType.name }}
						</mat-option>
					</mat-select>
					<mat-hint align="start">{{
						platformTypeState | async
					}}</mat-hint>
					<mat-hint align="end"
						>Find existing element information to create your
						element or create new type information.</mat-hint
					>
					<div matSuffix>
						<ng-container *ngIf="typeState !== 'QUERY'">
							<button
								mat-icon-button
								(click)="openSearch($event)"
								class="search-button">
								<mat-icon
									color="primary"
									data-cy="search-type-menu"
									>search</mat-icon
								>
							</button>
						</ng-container>
						<button
							mat-icon-button
							(click)="openPlatformTypeDialog($event)">
							<mat-icon color="success">add</mat-icon>
						</button>
					</div>
				</mat-form-field>
				<ng-container *ngIf="typeState === 'QUERY'">
					<mat-divider></mat-divider>
					<osee-messaging-platform-type-query
						[platformTypes]="(types | async) || []"
						(query)="
							receiveQuery($event)
						"></osee-messaging-platform-type-query>
					<br />
				</ng-container>
				<ng-container *ngIf="typeState === 'CREATE'">
					<mat-divider></mat-divider>
					<osee-new-type-form
						(typeFormState)="receivePlatformTypeData($event)"
						[preFillData]="
							(availableTypes | async) || []
						"></osee-new-type-form>
					<br />
				</ng-container>
			</ng-container>
		</ng-container>
		<ng-template #loading_types>
			<div class="tw-flex tw-items-center">
				<mat-spinner
					color="primary"
					diameter="20"
					class="tw-pr-4"
					data-cy="types-loading-spinner"></mat-spinner>
				<span>Loading Platform Types...</span>
			</div>
		</ng-template>
	</ng-container>
</form>
