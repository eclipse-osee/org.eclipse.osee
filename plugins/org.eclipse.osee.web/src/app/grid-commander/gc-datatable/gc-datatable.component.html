<!--
 * Copyright (c) 2022 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<div
	class="data-table-component"
	*ngIf="(displayedTableData | async)?.length; else noData">
	<ng-container *ngIf="dataSource | async as data">
		<table
			class="data-table mat-elevation-z8"
			mat-table
			[dataSource]="data"
			#dataTable
			matSort
			(matSortChange)="sortData($event, data.data)">
			<ng-container *ngIf="columnData | async as columnSchema">
				<ng-container
					[matColumnDef]="col.name"
					*ngFor="let col of columnSchema">
					<ng-container *ngIf="col.name === 'select'">
						<th
							mat-header-cell
							*matHeaderCellDef>
							<mat-checkbox
								(change)="$event ? masterToggle() : null"
								[checked]="
									selection.hasValue() && isAllSelected()
								"
								[indeterminate]="
									selection.hasValue() && !isAllSelected()
								">
							</mat-checkbox>
						</th>
					</ng-container>

					<ng-container
						*ngIf="
							col.name !== 'select' && col.name !== 'Action';
							else header
						">
						<th
							mat-header-cell
							*matHeaderCellDef
							class="data-table-header-cell"
							mat-sort-header>
							{{ col.name }}
						</th>
					</ng-container>
					<ng-template #header>
						<th
							mat-header-cell
							*matHeaderCellDef
							class="data-table-header-cell action-header">
							{{ col.name }}
						</th>
					</ng-template>

					<td
						class="table-cell"
						mat-cell
						*matCellDef="let row; let i = index">
						<ng-container
							[ngSwitch]="col.type"
							*ngIf="!row.isEdit">
							<div
								class="action-link"
								*ngSwitchCase="'Action'">
								<a>
									<mat-icon
										*ngIf="row.Favorite === 'false'"
										class="data-table-elements-icons-action-favorite"
										(click)="toggleFavorite(row)"
										matTooltip="Favorite Command"
										matTooltipClass="data-table-elements-tooltips-tooltip-accent">
										star_border
									</mat-icon>
									<mat-icon
										*ngIf="row.Favorite === 'true'"
										class="data-table-elements-icons-action-favorite"
										(click)="toggleFavorite(row)"
										matTooltip="Favorite Command"
										matTooltipClass="data-table-elements-tooltips-tooltip-accent">
										star
									</mat-icon>
								</a>
								<a>
									<mat-icon
										class="data-table-elements-icons-action-add"
										matTooltip="Add row"
										*ngIf="canAddRowViaAction | async"
										matTooltipClass="data-table-elements-tooltips-tooltip-success">
										add
									</mat-icon>
								</a>
								<a (click)="row.isEdit = !row.isEdit">
									<mat-icon
										class="data-table-elements-icons-action-edit"
										matTooltip="Edit row"
										*ngIf="canEditRowViaAction | async">
										mode_edit
									</mat-icon>
								</a>
								<a>
									<mat-icon
										class="data-table-elements-icons-action-delete"
										(click)="
											openDeleteRowDialog('Delete', row)
										"
										matTooltip="Delete row"
										matTooltipClass="data-table-elements-tooltips-tooltip-warn">
										delete
									</mat-icon>
								</a>
								<a>
									<mat-icon
										class="data-table-elements-icons-action-hide"
										(click)="hideRow(row)"
										*ngIf="canHideRowViaAction | async"
										matTooltip="Hide row"
										matTooltipClass="data-table-elements-tooltips-tooltip-primary">
										visibility_off
									</mat-icon>
								</a>
							</div>

							<ng-container *ngSwitchCase="'isSelect'">
								<div>
									<mat-checkbox
										(click)="$event.stopPropagation()"
										(change)="
											$event
												? onElementToggled(row)
												: null
										"
										[checked]="selection.isSelected(row)">
									</mat-checkbox>
								</div>
							</ng-container>
							<ng-container *ngSwitchDefault>
								<div (click)="onRowClicked(row)">
									{{ row[col.name] }}
								</div>
							</ng-container>
						</ng-container>
						<ng-container
							[ngSwitch]="col.type"
							*ngIf="row.isEdit">
							<div
								class="action-link"
								*ngSwitchCase="'Action'">
								<a (click)="row.isEdit = !row.isEdit">
									<mat-icon
										class="data-table-elements-icons-action-done"
										matTooltip="Save Changes"
										matTooltipClass="data-table-elements-tooltips-tooltip-success">
										done_outline
									</mat-icon>
								</a>

								<a (click)="row.isEdit = !row.isEdit">
									<mat-icon
										class="data-table-elements-icons-action-cancel"
										matTooltip="Cancel Changes"
										matTooltipClass="data-table-elements-tooltips-tooltip-warn">
										update_disabled
									</mat-icon>
								</a>
							</div>
							<ng-container *ngSwitchCase="'isSelect'">
								<div>
									<mat-checkbox
										disabled="true"
										style="opacity: 0"></mat-checkbox>
								</div>
							</ng-container>

							<mat-form-field
								class="data-table-form-input"
								appearance="outline"
								*ngSwitchDefault>
								<input
									[type]="col.name"
									matInput
									[(ngModel)]="row[col.name]" />
							</mat-form-field>
						</ng-container>
					</td>
				</ng-container>
			</ng-container>

			<ng-container *ngIf="displayedColumns | async as displayedCols">
				<tr
					mat-header-row
					*matHeaderRowDef="displayedCols; sticky: true"></tr>
				<tr
					mat-row
					*matRowDef="let row; columns: displayedCols; let i = index"
					[ngClass]="{
						highlighted: selection.isSelected(row),
						hidden: hiddenRows.value.includes(row),
						notHidden: hiddenRows.value.indexOf(row) === -1
					}"></tr>
			</ng-container>
		</table>
	</ng-container>
	<mat-toolbar class="mat-elevation-z4 toolbar">
		<mat-toolbar-row class="data-table-mat-toolbar-row">
			<div class="action-link">
				<button
					mat-icon-button
					matTooltip="Add row"
					matTooltipClass="data-table-elements-tooltips-tooltip-success"
					*ngIf="canAddRowViaAction | async">
					<mat-icon
						class="action-add data-table-elements-icons-action-add">
						add
					</mat-icon>
				</button>
				<button
					mat-icon-button
					matTooltip="Delete selected rows"
					matTooltipClass="data-table-elements-tooltips-tooltip-warn"
					*ngIf="multiRowDeleteActionIcon | async">
					<mat-icon class="data-table-elements-icons-action-delete">
						delete
					</mat-icon>
				</button>
				<button
					mat-icon-button
					matTooltip="Hide selected rows"
					matTooltipClass="data-table-elements-tooltips-tooltip-primary"
					(click)="hideSelectedRows()"
					*ngIf="canHideRowViaAction | async">
					<mat-icon class="data-table-elements-icons-action-hide">
						visibility_off
					</mat-icon>
				</button>
				<button
					mat-icon-button
					matTooltip="Unhide rows"
					matTooltipClass="data-table-elements-tooltips-tooltip-primary"
					[disabled]="hiddenRows.value.length === 0"
					(click)="showHiddenRows()"
					*ngIf="canHideRowViaAction | async">
					<mat-icon class="data-table-elements-icons-action-hide">
						visibility
					</mat-icon>
				</button>
			</div>
			<mat-paginator
				class="paginator"
				hidePageSize
				showFirstLastButtons
				pageSize="100"
				aria-label="Select page">
			</mat-paginator>
		</mat-toolbar-row>
	</mat-toolbar>
</div>
<ng-template #noData>
	<div class="no-data-container">
		<osee-no-data-to-display></osee-no-data-to-display>
	</div>
</ng-template>
