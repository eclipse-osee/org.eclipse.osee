<!--
 * Copyright (c) 2022 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<ng-container *ngIf="_options | async as _opt; else loadingMatOptions">
	{{ disableSelect ? setDisabled(false) : '' }}
	<ng-container
		*ngIf="
			paginationMode === 'AUTO' || paginationMode === 'MANUAL';
			else nonPaginated
		">
		<!--48 is avg size for mat-option-->
		<cdk-virtual-scroll-viewport
			itemSize="48"
			[minBufferPx]="getHeightPx(48, _opt.length)"
			[maxBufferPx]="getHeightPx(48, _opt.length)"
			[style.height.px]="getHeightPx(48, _opt.length)">
			<ng-template
				*cdkVirtualFor="let opt of _opt"
				let-opt
				[ngTemplateOutlet]="template"
				[ngTemplateOutletContext]="{ $implicit: opt, opt: opt }">
			</ng-template>
			<ng-container *ngIf="_opt.length === 0">
				<div class="tw-pl-4">No {{ objectName }} available.</div>
			</ng-container>
			<ng-container
				*ngIf="paginationMode === 'MANUAL' && _opt.length > 0">
				<div
					class="tw-flex tw-items-center"
					*ngIf="(_paginationComplete | async) === false">
					<button
						mat-button
						matListItemTitle
						class="tw-flex-grow"
						(click)="createPaginationEvent()">
						Show More
					</button>
				</div>
			</ng-container>
		</cdk-virtual-scroll-viewport>
	</ng-container>
	<ng-template #nonPaginated>
		<ng-template
			*ngFor="let opt of _opt"
			let-opt
			[ngTemplateOutlet]="template"
			[ngTemplateOutletContext]="{ $implicit: opt, opt: opt }">
		</ng-template>
		<ng-container *ngIf="_opt.length === 0">
			No {{ objectName }} available.
		</ng-container>
	</ng-template>
</ng-container>
<ng-template #loadingMatOptions>
	{{ disableSelect ? setDisabled(true) : '' }}
	<ng-container *ngIf="error | async as _error; else loadInProgress">
		<mat-option disabled>
			{{ _error }}
		</mat-option>
	</ng-container>
	<ng-template #loadInProgress>
		<mat-option disabled>
			<div class="tw-flex tw-items-center tw-gap-4">
				<mat-spinner
					color="primary"
					diameter="25"
					class="tw-inline-block"
					data-cy="mat-option-loading-spinner"></mat-spinner>
				<div>Loading...</div>
			</div>
		</mat-option>
	</ng-template>
</ng-template>
