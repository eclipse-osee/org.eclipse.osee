<!--
 * Copyright (c) 2021 Boeing
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Boeing - initial API and implementation
 -->
<ng-container
	*ngIf="{
		openedState: isOpen | async,
		filter: filter | async
	} as autoCompleteState">
	<mat-form-field
		appearance="fill"
		subscriptSizing="dynamic"
		class="branch-form-field tw-w-full">
		<mat-label>Select a Branch</mat-label>
		<input
			type="text"
			matInput
			#input
			[ngModel]="autoCompleteState.filter"
			[disabled]="(selectedBranchType | async) === ''"
			placeholder="Branches"
			[errorStateMatcher]="errorMatcher"
			id="branches"
			name="branches"
			(focusin)="autoCompleteOpened()"
			(focusout)="close()"
			(ngModelChange)="updateTypeAhead($event)"
			#branches="ngModel"
			[matAutocomplete]="autoBranches" />
		<mat-autocomplete
			autoActiveFirstOption="true"
			autoSelectActiveOption="true"
			#autoBranches="matAutocomplete"
			(optionSelected)="selectBranch($event.option.value)">
			<ng-container *ngIf="_branches | async as branches; else loading">
				<ng-container *ngIf="_count | async as count; else loading">
					<ng-container *ngIf="_size | async as size; else loading">
						<osee-mat-option-loading
							[data]="branches"
							objectName="Branches"
							[paginationSize]="size"
							paginationMode="AUTO"
							[count]="count">
							<ng-template let-option>
								<mat-option
									[attr.data-cy]="'option-' + option.name"
									[value]="option"
									[id]="option.id">
									{{ option.name }}
								</mat-option>
							</ng-template>
						</osee-mat-option-loading>
					</ng-container>
				</ng-container>
			</ng-container>
			<ng-template #loading>
				<mat-option
					id="-1"
					[value]="{ id: '-1', name: 'invalid' }">
					Loading...
				</mat-option>
			</ng-template>
		</mat-autocomplete>
	</mat-form-field>
</ng-container>
